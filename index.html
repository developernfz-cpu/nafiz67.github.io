<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAFIZ EMPIRE - Bangladeshi Open World</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            overflow: hidden;
            font-family: 'Segoe UI', 'Kalpurush', 'Arial', sans-serif;
            background: #000;
            color: white;
            touch-action: none;
            cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="%23f42a41" opacity="0.8"/><circle cx="16" cy="16" r="6" fill="%23ffffff"/></svg>') 16 16, auto;
        }

        canvas {
            display: block;
        }

        /* LOADING SCREEN */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                #006a4e 0%, #00563d 25%, 
                #f42a41 25%, #d92338 50%,
                #006a4e 50%, #00563d 75%,
                #f42a41 75%, #d92338 100%);
            background-size: 400% 400%;
            animation: gradientBG 8s ease infinite;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.2s;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bangladeshi-flag {
            width: 300px;
            height: 180px;
            background: #006a4e;
            border-radius: 10px;
            position: relative;
            margin-bottom: 40px;
            border: 5px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.6),
                0 0 0 10px rgba(244,42,65,0.2),
                inset 0 0 30px rgba(0,0,0,0.4);
            transform-style: preserve-3d;
            perspective: 1000px;
            animation: flagFloat 6s ease-in-out infinite;
        }

        @keyframes flagFloat {
            0%, 100% { transform: translateY(0) rotateX(5deg); }
            50% { transform: translateY(-20px) rotateX(-5deg); }
        }

        .bangladeshi-flag::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: #f42a41;
            border-radius: 50%;
            box-shadow: 
                0 0 40px rgba(244,42,65,0.8),
                inset 0 0 20px rgba(255,255,255,0.3);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .loader {
            width: 120px;
            height: 120px;
            border: 6px solid rgba(255,255,255,0.1);
            border-top: 6px solid #f42a41;
            border-right: 6px solid #006a4e;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(244,42,65,0.4);
        }

        #loadingText {
            font-size: 28px;
            margin-top: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.7);
            background: linear-gradient(45deg, #006a4e, #f42a41, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: textGlow 2s ease-in-out infinite;
        }

        @keyframes textGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(244,42,65,0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(244,42,65,0.8)); }
        }

        .loading-progress {
            width: 400px;
            height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-top: 30px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, 
                #006a4e 0%, 
                #00a86b 25%,
                #f42a41 50%,
                #ff6b8b 75%,
                #ffd700 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .loading-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255,255,255,0.3) 50%,
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* GAME CONTAINER */
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* HUD */
        #hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            font-family: 'Kalpurush', 'Segoe UI', sans-serif;
        }

        .hud-top-left {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .hud-top-right {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 15px;
        }

        .hud-bottom-center {
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .hud-stat {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            padding: 15px 25px;
            backdrop-filter: blur(15px) saturate(180%);
            border: 2px solid #006a4e;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.4),
                0 0 0 1px rgba(255,255,255,0.1),
                inset 0 0 20px rgba(0,106,78,0.3);
            min-width: 250px;
            position: relative;
            overflow: hidden;
        }

        .hud-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #006a4e, #f42a41);
            border-radius: 20px 20px 0 0;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            color: #f42a41;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .stat-header i {
            font-size: 20px;
            margin-right: 10px;
        }

        .stat-bar-container {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 3px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.4);
        }

        .stat-bar {
            width: 100%;
            height: 14px;
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.3) 0%,
                rgba(0,0,0,0.1) 100%);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .stat-fill {
            height: 100%;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 20px currentColor,
                inset 0 2px 4px rgba(255,255,255,0.2);
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.3) 50%,
                rgba(255,255,255,0) 100%);
            animation: barShine 2s infinite;
        }

        @keyframes barShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #healthBar { 
            background: linear-gradient(90deg, 
                #f42a41 0%,
                #ff6b6b 50%,
                #ff8e8e 100%);
            color: #f42a41;
        }
        
        #staminaBar { 
            background: linear-gradient(90deg, 
                #00a8ff 0%,
                #4cd137 50%,
                #7bed9f 100%);
            color: #00a8ff;
        }
        
        #armorBar { 
            background: linear-gradient(90deg, 
                #9b59b6 0%,
                #8e44ad 50%,
                #af7ac5 100%);
            color: #9b59b6;
        }

        .hud-value {
            font-size: 24px;
            font-weight: bold;
            margin-top: 5px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.7);
        }

        #money { 
            color: #f1c40f;
            background: linear-gradient(45deg, #f1c40f, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 28px;
            text-shadow: 0 2px 10px rgba(241,196,15,0.3);
        }

        #score {
            color: #00a8ff;
            font-size: 22px;
        }

        #weaponDisplay {
            background: linear-gradient(135deg, 
                rgba(0,0,0,0.9) 0%,
                rgba(20,20,30,0.9) 100%);
            padding: 15px 30px;
            border-radius: 25px;
            border: 3px solid #f42a41;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 
                0 10px 30px rgba(244,42,65,0.3),
                0 0 0 2px rgba(255,255,255,0.1);
            min-width: 200px;
            backdrop-filter: blur(10px);
        }

        #weaponDisplay i {
            font-size: 24px;
            color: #f42a41;
            filter: drop-shadow(0 0 8px #f42a41);
        }

        #weaponName {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        #ammoDisplay {
            margin-left: auto;
            color: #00a8ff;
            font-size: 16px;
            background: rgba(0,168,255,0.1);
            padding: 5px 12px;
            border-radius: 12px;
            border: 1px solid rgba(0,168,255,0.3);
        }

        #locationDisplay {
            background: linear-gradient(135deg, 
                rgba(0,106,78,0.9) 0%,
                rgba(0,86,61,0.9) 100%);
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 16px;
            border: 2px solid #f42a41;
            box-shadow: 
                0 8px 25px rgba(0,106,78,0.4),
                0 0 0 1px rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
        }

        #locationDisplay i {
            color: #f42a41;
            font-size: 18px;
            filter: drop-shadow(0 0 6px #f42a41);
        }

        #locationName {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* TIME DISPLAY */
        #timeDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, 
                rgba(0,0,0,0.9) 0%,
                rgba(20,20,40,0.9) 100%);
            padding: 12px 30px;
            border-radius: 25px;
            border: 2px solid #006a4e;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            min-width: 150px;
        }

        #timeDisplay i {
            color: #f42a41;
            font-size: 18px;
            animation: timePulse 4s infinite;
        }

        @keyframes timePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        #timeText {
            color: #00a8ff;
            text-shadow: 0 0 10px rgba(0,168,255,0.5);
        }

        /* MISSION NOTIFICATION */
        #missionNotification {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, 
                rgba(0,106,78,0.95) 0%,
                rgba(0,86,61,0.95) 100%);
            border-left: 6px solid #f42a41;
            padding: 20px 35px;
            border-radius: 20px;
            z-index: 40;
            display: none;
            backdrop-filter: blur(20px);
            animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.6),
                0 0 0 2px rgba(255,255,255,0.1);
            max-width: 500px;
            text-align: center;
            border: 2px solid #f42a41;
        }

        @keyframes slideDown {
            from { 
                transform: translateX(-50%) translateY(-100px) scale(0.9); 
                opacity: 0; 
            }
            to { 
                transform: translateX(-50%) translateY(0) scale(1); 
                opacity: 1; 
            }
        }

        #missionNotification::before {
            content: 'üì¢';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
            animation: bellRing 2s infinite;
        }

        @keyframes bellRing {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-50%) rotate(-10deg); }
            20%, 40%, 60%, 80% { transform: translateX(-50%) rotate(10deg); }
        }

        #missionNotification strong {
            color: #f42a41;
            font-size: 20px;
            display: block;
            margin-bottom: 8px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        #missionNotification span {
            color: white;
            font-size: 16px;
            line-height: 1.5;
            text-shadow: 0 1px 4px rgba(0,0,0,0.5);
        }

        /* ADVANCED MOBILE CONTROLS */
        #mobileControls {
            position: fixed;
            bottom: 40px;
            left: 40px;
            right: 40px;
            z-index: 20;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 25px;
            pointer-events: auto;
        }

        .joystick {
            width: 160px;
            height: 160px;
            background: radial-gradient(circle at 30% 30%, 
                #006a4e 0%,
                #00563d 30%,
                #00432c 70%,
                #003020 100%);
            border-radius: 50%;
            position: relative;
            border: 6px solid #f42a41;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.6),
                0 0 0 3px rgba(255,255,255,0.2),
                inset 0 0 40px rgba(0,0,0,0.5),
                0 0 60px rgba(244,42,65,0.3);
            transform-style: preserve-3d;
            perspective: 500px;
        }

        .joystick::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 40% 40%,
                #f42a41 0%,
                #d92338 50%,
                #b81c2f 100%);
            border-radius: 50%;
            z-index: 1;
            box-shadow: 
                0 0 40px rgba(244,42,65,0.8),
                inset 0 5px 20px rgba(255,255,255,0.4);
            animation: innerPulse 3s infinite;
        }

        @keyframes innerPulse {
            0%, 100% { box-shadow: 0 0 40px rgba(244,42,65,0.8); }
            50% { box-shadow: 0 0 60px rgba(244,42,65,1); }
        }

        .joystick-handle {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 40% 40%,
                #ffffff 0%,
                #e0e0e0 30%,
                #c0c0c0 70%,
                #a0a0a0 100%);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 5px solid #f42a41;
            box-shadow: 
                0 0 40px rgba(244,42,65,0.6),
                inset 0 8px 30px rgba(255,255,255,0.9),
                0 10px 30px rgba(0,0,0,0.4);
            z-index: 2;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: move;
        }

        /* Action Buttons */
        .action-button {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            color: white;
            font-size: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 12px 35px rgba(0,0,0,0.5),
                0 0 0 4px rgba(255,255,255,0.15),
                inset 0 0 30px rgba(255,255,255,0.1);
            transform-style: preserve-3d;
            perspective: 500px;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 30%,
                rgba(255,255,255,0.3) 0%,
                rgba(255,255,255,0.1) 40%,
                transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .action-button::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: inherit;
            border-radius: 50%;
            filter: blur(20px);
            opacity: 0.5;
            z-index: -1;
            animation: buttonGlow 3s infinite;
        }

        @keyframes buttonGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .action-button:active {
            transform: scale(0.85) translateZ(-20px);
            box-shadow: 
                0 6px 20px rgba(0,0,0,0.4),
                0 0 0 3px rgba(255,255,255,0.2),
                inset 0 0 40px rgba(0,0,0,0.3);
        }

        .action-button:active::before {
            opacity: 1;
        }

        .action-button i {
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
            transition: transform 0.2s;
        }

        .action-button:active i {
            transform: scale(1.2);
        }

        /* Individual Button Themes */
        #jumpBtn { 
            background: linear-gradient(135deg, 
                #27ae60 0%,
                #2ecc71 25%,
                #4cd137 50%,
                #7bed9f 75%,
                #55efc4 100%);
            border: 5px solid #2ecc71;
        }
        
        #attackBtn { 
            background: linear-gradient(135deg, 
                #c0392b 0%,
                #e74c3c 25%,
                #ff6b6b 50%,
                #ff8e8e 75%,
                #ffafaf 100%);
            border: 5px solid #ff0000;
            animation: attackPulse 1.5s infinite;
        }
        
        @keyframes attackPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            50% { box-shadow: 0 0 0 25px rgba(231, 76, 60, 0); }
        }
        
        #interactBtn { 
            background: linear-gradient(135deg, 
                #2980b9 0%,
                #3498db 25%,
                #00a8ff 50%,
                #74b9ff 75%,
                #a29bfe 100%);
            border: 5px solid #3498db;
        }
        
        #menuBtn { 
            background: linear-gradient(135deg, 
                #8e44ad 0%,
                #9b59b6 25%,
                #a29bfe 50%,
                #c8a2c8 75%,
                #d6a2e8 100%);
            border: 5px solid #9b59b6;
        }

        #weaponBtn {
            background: linear-gradient(135deg, 
                #e67e22 0%,
                #f39c12 25%,
                #fdcb6e 50%,
                #ffeaa7 75%,
                #ffeb3b 100%);
            border: 5px solid #f39c12;
            width: 100px;
            height: 100px;
            font-size: 38px;
        }

        #runBtn {
            background: linear-gradient(135deg, 
                #00b894 0%,
                #00cec9 25%,
                #81ecec 50%,
                #a3f7bf 75%,
                #55efc4 100%);
            border: 5px solid #00cec9;
            width: 90px;
            height: 90px;
        }

        /* First Person Crosshair */
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            pointer-events: none;
            z-index: 5;
            mix-blend-mode: difference;
        }

        .crosshair-dot {
            width: 8px;
            height: 8px;
            background: #f42a41;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 
                0 0 20px #f42a41,
                0 0 40px rgba(244,42,65,0.5),
                inset 0 0 10px rgba(255,255,255,0.3);
            animation: crosshairPulse 2s infinite;
        }

        @keyframes crosshairPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .crosshair-line {
            position: absolute;
            background: #f42a41;
            border-radius: 2px;
            box-shadow: 0 0 10px #f42a41;
        }

        .crosshair-horizontal {
            width: 20px;
            height: 4px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(90deg,
                transparent 0%,
                #f42a41 20%,
                #f42a41 80%,
                transparent 100%);
        }

        .crosshair-vertical {
            width: 4px;
            height: 20px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(0deg,
                transparent 0%,
                #f42a41 20%,
                #f42a41 80%,
                transparent 100%);
        }

        /* MINIMAP */
        #miniMap {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 220px;
            height: 220px;
            background: linear-gradient(135deg, 
                rgba(0,0,0,0.9) 0%,
                rgba(20,30,40,0.9) 100%);
            border-radius: 25px;
            border: 4px solid #006a4e;
            z-index: 15;
            overflow: hidden;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.6),
                0 0 0 2px rgba(255,255,255,0.1),
                inset 0 0 30px rgba(0,106,78,0.3);
            backdrop-filter: blur(10px);
        }

        .mini-map-header {
            background: linear-gradient(90deg, #006a4e, #f42a41);
            padding: 10px 15px;
            font-weight: bold;
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .mini-map-content {
            width: 100%;
            height: calc(100% - 40px);
            position: relative;
            background: rgba(0,50,30,0.3);
        }

        .mini-map-player {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f42a41;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 
                0 0 15px #f42a41,
                0 0 30px rgba(244,42,65,0.5),
                inset 0 0 10px rgba(255,255,255,0.5);
            border: 2px solid white;
            z-index: 10;
            animation: playerBlip 2s infinite;
        }

        @keyframes playerBlip {
            0%, 100% { box-shadow: 0 0 15px #f42a41; }
            50% { box-shadow: 0 0 25px #f42a41, 0 0 40px rgba(244,42,65,0.7); }
        }

        .mini-map-npc {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #3498db;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid white;
        }

        .mini-map-vehicle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #f1c40f;
            border-radius: 2px;
            transform: translate(-50%, -50%) rotate(45deg);
            border: 1px solid white;
        }

        /* Hit Effect */
        .hit-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 25;
            opacity: 0;
            transition: opacity 0.15s;
            mix-blend-mode: screen;
        }

        .hit-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, 
                rgba(244,42,65,0) 0%,
                rgba(244,42,65,0.4) 40%,
                rgba(244,42,65,0.2) 70%,
                transparent 100%);
        }

        .hit-effect::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, 
                rgba(255,255,255,0.8) 0%,
                rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%);
            border-radius: 50%;
            animation: hitFlash 0.3s;
        }

        @keyframes hitFlash {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }

        /* MENUS */
        .menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center,
                rgba(0,106,78,0.95) 0%,
                rgba(0,86,61,0.95) 40%,
                rgba(0,66,47,0.95) 100%);
            z-index: 30;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(30px);
            animation: menuFade 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes menuFade {
            from { opacity: 0; transform: scale(1.1); }
            to { opacity: 1; transform: scale(1); }
        }

        .menu-content {
            background: linear-gradient(135deg, 
                rgba(0,0,0,0.95) 0%,
                rgba(20,20,40,0.95) 100%);
            border-radius: 35px;
            padding: 50px;
            max-width: 600px;
            width: 90%;
            border: 4px solid #f42a41;
            box-shadow: 
                0 30px 80px rgba(244,42,65,0.4),
                0 0 0 2px rgba(255,255,255,0.1),
                inset 0 0 50px rgba(0,106,78,0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .menu-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: conic-gradient(
                from 0deg,
                transparent 0%,
                rgba(244,42,65,0.1) 10%,
                transparent 20%,
                rgba(0,106,78,0.1) 30%,
                transparent 40%,
                rgba(244,42,65,0.1) 50%,
                transparent 60%,
                rgba(0,106,78,0.1) 70%,
                transparent 80%,
                rgba(244,42,65,0.1) 90%,
                transparent 100%
            );
            animation: menuRotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes menuRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .menu h2 {
            color: #f42a41;
            margin-bottom: 40px;
            text-align: center;
            font-size: 48px;
            text-shadow: 
                0 0 30px rgba(244,42,65,0.8),
                0 0 60px rgba(244,42,65,0.5);
            font-weight: bold;
            background: linear-gradient(45deg, #f42a41, #ff6b6b, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(244,42,65,0.6)); }
            50% { filter: drop-shadow(0 0 40px rgba(244,42,65,0.9)); }
        }

        .menu-button {
            width: 100%;
            padding: 22px;
            margin: 15px 0;
            background: linear-gradient(135deg, 
                rgba(0,106,78,0.8) 0%,
                rgba(0,86,61,0.8) 100%);
            border: 3px solid #f42a41;
            color: white;
            border-radius: 20px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        .menu-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255,255,255,0.2) 50%,
                transparent 100%);
            transition: left 0.6s;
        }

        .menu-button:hover {
            background: linear-gradient(135deg, 
                rgba(0,135,90,0.9) 0%,
                rgba(0,106,78,0.9) 100%);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(244,42,65,0.4),
                0 0 0 2px rgba(255,255,255,0.2);
        }

        .menu-button:hover::before {
            left: 100%;
        }

        .menu-button:active {
            transform: translateY(0) scale(0.98);
        }

        .menu-button i {
            font-size: 26px;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.5));
        }

        /* RESPONSIVE DESIGN - UPDATED FOR PC */
        @media (max-width: 768px) {
            .joystick {
                width: 130px;
                height: 130px;
            }
            
            .action-button {
                width: 75px;
                height: 75px;
                font-size: 28px;
            }
            
            #weaponBtn {
                width: 80px;
                height: 80px;
                font-size: 32px;
            }
            
            #runBtn {
                width: 75px;
                height: 75px;
            }
            
            .hud-stat {
                padding: 12px 20px;
                font-size: 14px;
                min-width: 200px;
            }
            
            #miniMap {
                width: 170px;
                height: 170px;
                bottom: 30px;
                right: 30px;
            }
            
            .menu-content {
                padding: 30px;
            }
            
            .menu h2 {
                font-size: 36px;
            }
            
            .menu-button {
                padding: 18px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .hud-top-left, .hud-top-right {
                transform: scale(0.8);
                transform-origin: top left;
            }
            
            .hud-top-right {
                transform: scale(0.8);
                transform-origin: top right;
            }
            
            #mobileControls {
                bottom: 20px;
                left: 20px;
                right: 20px;
            }
            
            .joystick {
                width: 110px;
                height: 110px;
            }
            
            .action-button {
                width: 65px;
                height: 65px;
                font-size: 24px;
            }
        }

        /* PC-SPECIFIC STYLES */
        @media (min-width: 769px) {
            /* Hide mobile controls on PC */
            #mobileControls {
                display: none !important;
            }
            
            /* Adjust HUD for PC */
            .hud-top-left {
                top: 10px;
                left: 10px;
                transform: scale(0.85);
                transform-origin: top left;
            }
            
            .hud-top-right {
                top: 10px;
                right: 10px;
                transform: scale(0.85);
                transform-origin: top right;
            }
            
            #miniMap {
                bottom: 20px;
                right: 20px;
                width: 180px;
                height: 180px;
            }
            
            #crosshair {
                width: 24px;
                height: 24px;
            }
            
            .crosshair-dot {
                width: 6px;
                height: 6px;
            }
            
            .crosshair-horizontal {
                width: 16px;
                height: 3px;
            }
            
            .crosshair-vertical {
                width: 3px;
                height: 16px;
            }
            
            /* Make menus larger for PC */
            .menu-content {
                max-width: 800px;
                padding: 60px;
            }
            
            .menu h2 {
                font-size: 52px;
            }
            
            .menu-button {
                padding: 25px;
                font-size: 24px;
            }
        }

        /* Chromebook specific */
        @media (max-width: 1366px) and (min-width: 768px) {
            #miniMap {
                width: 150px;
                height: 150px;
            }
            
            .hud-stat {
                min-width: 180px;
                padding: 10px 15px;
            }
        }

        /* DEBUG INFO */
        #debugInfo {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 100;
            display: none;
            border: 1px solid #00ff00;
            max-width: 300px;
        }

        /* ACHIEVEMENT POPUP */
        #achievementPopup {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, 
                rgba(0,106,78,0.95) 0%,
                rgba(0,86,61,0.95) 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 6px solid #ffd700;
            z-index: 35;
            display: none;
            animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            min-width: 250px;
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%) translateY(-50%); opacity: 0; }
            to { transform: translateX(0) translateY(-50%); opacity: 1; }
        }

        #achievementPopup i {
            color: #ffd700;
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
            animation: achievementIcon 2s infinite;
        }

        @keyframes achievementIcon {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-10deg); }
            75% { transform: scale(1.1) rotate(10deg); }
        }

        /* LOADING TIPS */
        #loadingTips {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 18px;
            max-width: 600px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.7);
            opacity: 0.8;
            animation: tipFade 8s infinite;
        }

        @keyframes tipFade {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* BLOOM EFFECT */
        .bloom-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            mix-blend-mode: screen;
            opacity: 0.3;
            filter: blur(20px);
            background: radial-gradient(circle at 50% 50%, 
                rgba(244,42,65,0.3) 0%,
                rgba(0,106,78,0.2) 30%,
                transparent 70%);
        }

        /* FOG EFFECT */
        .fog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, 
                transparent 0%,
                rgba(0,106,78,0.1) 40%,
                rgba(0,86,61,0.2) 100%);
            pointer-events: none;
            z-index: 4;
            animation: fogMove 30s linear infinite;
        }

        @keyframes fogMove {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 50px) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }

        /* Control visibility toggle */
        .control-visibility-toggle {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,106,78,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            border: 2px solid #f42a41;
            cursor: pointer;
            z-index: 100;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 768px) {
            .control-visibility-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- ADVANCED LOADING SCREEN -->
    <div id="loadingScreen">
        <div class="bangladeshi-flag"></div>
        <div class="loader"></div>
        <h2 style="font-size: 48px; margin-bottom: 15px; color: white; text-shadow: 4px 4px 12px rgba(0,0,0,0.8);">NAFIZ EMPIRE</h2>
        <p style="color: #ffd700; margin-bottom: 30px; font-size: 22px; font-weight: bold; text-shadow: 0 2px 8px rgba(0,0,0,0.7);">
            üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶ì‡¶™‡ßá‡¶® ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶≤‡ßç‡¶° ‡¶ó‡ßá‡¶Æ‡¶ø‡¶Ç ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶∏ üáßüá©
        </p>
        <div id="loadingText">‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div id="loadingTips">
            üí° ‡¶ü‡¶ø‡¶™: ‡¶∂‡¶π‡¶∞‡ßá ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßã‡¶™‡¶® ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ ‡¶Ü‡¶¨‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®!
        </div>
        <div style="position: absolute; bottom: 30px; color: rgba(255,255,255,0.5); font-size: 14px;">
            Powered by Three.js ‚Ä¢ Optimized for Mobile & PC ‚Ä¢ Made with ‚ù§Ô∏è for Bangladesh
        </div>
    </div>

    <!-- GAME CONTAINER -->
    <div id="gameContainer"></div>

    <!-- VISUAL EFFECTS -->
    <div class="bloom-layer"></div>
    <div class="fog-overlay"></div>

    <!-- ADVANCED HUD -->
    <div id="hud">
        <!-- First Person Crosshair -->
        <div id="crosshair">
            <div class="crosshair-dot"></div>
            <div class="crosshair-line crosshair-horizontal"></div>
            <div class="crosshair-line crosshair-vertical"></div>
        </div>

        <!-- Top Left HUD -->
        <div class="hud-top-left">
            <div class="hud-stat">
                <div class="stat-header">
                    <span><i class="fas fa-heart-pulse"></i> ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø</span>
                    <span id="healthValue">100%</span>
                </div>
                <div class="stat-bar-container">
                    <div class="stat-bar">
                        <div id="healthBar" class="stat-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div class="hud-stat">
                <div class="stat-header">
                    <span><i class="fas fa-bolt-lightning"></i> ‡¶∂‡¶ï‡ßç‡¶§‡¶ø</span>
                    <span id="staminaValue">100%</span>
                </div>
                <div class="stat-bar-container">
                    <div class="stat-bar">
                        <div id="staminaBar" class="stat-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div class="hud-stat">
                <div class="stat-header">
                    <span><i class="fas fa-shield-halved"></i> ‡¶Ü‡¶∞‡ßç‡¶Æ‡¶æ‡¶∞</span>
                    <span id="armorValue">0%</span>
                </div>
                <div class="stat-bar-container">
                    <div class="stat-bar">
                        <div id="armorBar" class="stat-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Right HUD -->
        <div class="hud-top-right">
            <div id="weaponDisplay">
                <i class="fas fa-gun"></i>
                <span id="weaponName">‡¶è‡¶Æ-‡ßß‡ß¨ ‡¶∞‡¶æ‡¶á‡¶´‡ßá‡¶≤</span>
                <div id="ammoDisplay">
                    <i class="fas fa-bullseye"></i> <span id="ammoCount">30/120</span>
                </div>
            </div>
            
            <div id="locationDisplay">
                <i class="fas fa-location-crosshairs"></i>
                <span id="locationName">‡¶¢‡¶æ‡¶ï‡¶æ ‡¶∏‡ßá‡¶®‡¶æ‡¶®‡¶ø‡¶¨‡¶æ‡¶∏</span>
            </div>
            
            <div class="hud-stat" style="min-width: 200px;">
                <div class="stat-header">
                    <span><i class="fas fa-money-bill-wave"></i> ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
                <div class="hud-value" id="money">‡ß≥ ‡ßß‡ß¶,‡ß¶‡ß¶‡ß¶</div>
            </div>
            
            <div class="hud-stat" style="min-width: 180px;">
                <div class="stat-header">
                    <span><i class="fas fa-trophy"></i> ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</span>
                </div>
                <div class="hud-value" id="score">‡ß®,‡ß´‡ß¶‡ß¶</div>
            </div>
        </div>

        <!-- Time Display -->
        <div id="timeDisplay">
            <i class="fas fa-sun"></i>
            <span id="timeText">‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßß‡ßß:‡ß©‡ß¶</span>
        </div>

        <!-- Mission Notification -->
        <div id="missionNotification">
            <strong>‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶ø‡¶∂‡¶®!</strong>
            <span id="missionText">‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶®‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
        </div>

        <!-- Hit Effect -->
        <div class="hit-effect" id="hitEffect"></div>

        <!-- Achievement Popup -->
        <div id="achievementPopup">
            <i class="fas fa-trophy"></i>
            <strong style="color: #ffd700; display: block; margin-bottom: 5px;">‡¶Ö‡¶∞‡ßç‡¶ú‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!</strong>
            <span id="achievementText">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</span>
        </div>

        <!-- Minimap -->
        <div id="miniMap">
            <div class="mini-map-header">
                <i class="fas fa-map"></i> ‡¶Æ‡¶ø‡¶®‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™
            </div>
            <div class="mini-map-content" id="miniMapContent">
                <div class="mini-map-player"></div>
            </div>
        </div>
    </div>

    <!-- PREMIUM MOBILE CONTROLS -->
    <div id="mobileControls">
        <div class="control-group">
            <div class="joystick" id="moveJoystick">
                <div class="joystick-handle"></div>
            </div>
            <div class="action-button" id="jumpBtn">
                <i class="fas fa-up-long"></i>
            </div>
            <div class="action-button" id="runBtn">
                <i class="fas fa-person-running"></i>
            </div>
        </div>
        
        <div class="control-group">
            <div class="action-button" id="weaponBtn">
                <i class="fas fa-repeat"></i>
            </div>
            <div class="action-button" id="attackBtn">
                <i class="fas fa-crosshairs"></i>
            </div>
            <div class="action-button" id="interactBtn">
                <i class="fas fa-handshake-angle"></i>
            </div>
            <div class="action-button" id="menuBtn">
                <i class="fas fa-gear"></i>
            </div>
        </div>
    </div>

    <!-- MAIN MENU -->
    <div id="mainMenu" class="menu">
        <div class="menu-content">
            <h2>NAFIZ EMPIRE</h2>
            <button class="menu-button" id="resumeBtn">
                <i class="fas fa-play-circle"></i> ‡¶ó‡ßá‡¶Æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®
            </button>
            <button class="menu-button" id="newGameBtn">
                <i class="fas fa-rocket"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶≠‡¶ø‡¶Ø‡¶æ‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <button class="menu-button" id="loadGameBtn">
                <i class="fas fa-folder-open"></i> ‡¶∏‡ßá‡¶≠ ‡¶ó‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <button class="menu-button" id="settingsBtn">
                <i class="fas fa-sliders"></i> ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
            </button>
            <button class="menu-button" id="missionsBtn">
                <i class="fas fa-flag-checkered"></i> ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø
            </button>
            <button class="menu-button" id="inventoryBtn">
                <i class="fas fa-warehouse"></i> ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø
            </button>
            <button class="menu-button" id="helpBtn">
                <i class="fas fa-graduation-cap"></i> ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶Æ‡ßã‡¶°
            </button>
        </div>
    </div>

    <!-- SETTINGS MENU -->
    <div id="settingsMenu" class="menu">
        <div class="menu-content">
            <h2><i class="fas fa-sliders"></i> ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2>
            <button class="menu-button" id="backBtn">
                <i class="fas fa-arrow-left-long"></i> ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶Æ‡ßá‡¶®‡ßÅ
            </button>
            
            <div style="margin: 30px 0; color: #f42a41; text-align: left;">
                <div style="margin: 20px 0; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                    <label style="display: block; margin-bottom: 10px; font-size: 20px; color: #00a8ff;">
                        <i class="fas fa-display"></i> ‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                    </label>
                    <select id="graphicsQuality" style="width: 100%; padding: 15px; background: #111; color: white; border: 2px solid #006a4e; border-radius: 12px; font-size: 18px; margin-bottom: 15px;">
                        <option value="low">‡¶≤‡ßã (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶°)</option>
                        <option value="medium" selected>‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ (‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡¶°)</option>
                        <option value="high">‡¶π‡¶æ‡¶á (‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§)</option>
                        <option value="ultra">‡¶Ü‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤)</option>
                    </select>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 16px;">‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ö‡¶æ‡¶∞ ‡¶ï‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø</label>
                            <select style="width: 100%; padding: 12px; background: #222; color: white; border: 1px solid #006a4e; border-radius: 8px;">
                                <option>‡¶≤‡ßã</option>
                                <option selected>‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</option>
                                <option>‡¶π‡¶æ‡¶á</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 16px;">‡¶∂‡ßá‡¶°‡ßã ‡¶ï‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø</label>
                            <select style="width: 100%; padding: 12px; background: #222; color: white; border: 1px solid #006a4e; border-radius: 8px;">
                                <option>‡¶Ö‡¶´</option>
                                <option>‡¶≤‡ßã</option>
                                <option selected>‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</option>
                                <option>‡¶π‡¶æ‡¶á</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 16px;">‡¶è‡¶®‡ßç‡¶ü‡¶ø-‡¶è‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∏‡¶ø‡¶Ç</label>
                            <select style="width: 100%; padding: 12px; background: #222; color: white; border: 1px solid #006a4e; border-radius: 8px;">
                                <option>‡¶Ö‡¶´</option>
                                <option>2x</option>
                                <option selected>4x</option>
                                <option>8x</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 16px;">‡¶¨‡ßç‡¶≤‡ßÅ‡¶Æ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü</label>
                            <select style="width: 100%; padding: 12px; background: #222; color: white; border: 1px solid #006a4e; border-radius: 8px;">
                                <option>‡¶Ö‡¶´</option>
                                <option selected>‡¶Ö‡¶®</option>
                                <option>‡¶π‡¶æ‡¶á</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="margin: 20px 0; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                    <label style="display: block; margin-bottom: 10px; font-size: 20px; color: #00a8ff;">
                        <i class="fas fa-gamepad"></i> ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                    </label>
                    <select id="controlType" style="width: 100%; padding: 15px; background: #111; color: white; border: 2px solid #006a4e; border-radius: 12px; font-size: 18px; margin-bottom: 15px;">
                        <option value="touch">‡¶ü‡¶æ‡¶ö ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤)</option>
                        <option value="keyboard" selected>‡¶ï‡ßÄ‡¶¨‡ßã‡¶∞‡ßç‡¶° + ‡¶Æ‡¶æ‡¶â‡¶∏ (‡¶™‡¶ø‡¶∏‡¶ø)</option>
                        <option value="gamepad">‡¶ó‡ßá‡¶Æ‡¶™‡ßç‡¶Ø‡¶æ‡¶°</option>
                        <option value="hybrid">‡¶π‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡¶ø‡¶° ‡¶Æ‡ßã‡¶°</option>
                    </select>
                    
                    <div style="margin-top: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                            <input type="checkbox" id="vibration" checked style="width: 20px; height: 20px;">
                            <span>‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                            <input type="checkbox" id="autoRun" checked style="width: 20px; height: 20px;">
                            <span>‡¶Ö‡¶ü‡ßã ‡¶∞‡¶æ‡¶®</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                            <input type="checkbox" id="aimAssist" checked style="width: 20px; height: 20px;">
                            <span>‡¶è‡¶Æ ‡¶è‡¶∏‡¶ø‡¶∏‡ßç‡¶ü</span>
                        </label>
                    </div>
                </div>
                
                <div style="margin: 20px 0; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                    <label style="display: block; margin-bottom: 10px; font-size: 20px; color: #00a8ff;">
                        <i class="fas fa-volume-high"></i> ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                    </label>
                    <div style="margin: 15px 0;">
                        <label style="display: block; margin-bottom: 8px;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï</label>
                        <input type="range" min="0" max="100" value="70" style="width: 100%;">
                    </div>
                    <div style="margin: 15px 0;">
                        <label style="display: block; margin-bottom: 8px;">‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü</label>
                        <input type="range" min="0" max="100" value="90" style="width: 100%;">
                    </div>
                    <div style="margin: 15px 0;">
                        <label style="display: block; margin-bottom: 8px;">‡¶≠‡¶Ø‡¶º‡ßá‡¶∏</label>
                        <input type="range" min="0" max="100" value="80" style="width: 100%;">
                    </div>
                </div>
            </div>
            
            <button class="menu-button" onclick="saveSettings()" style="background: linear-gradient(135deg, #f42a41, #ff6b6b);">
                <i class="fas fa-save"></i> ‡¶∏‡¶¨ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>

    <!-- MISSIONS MENU -->
    <div id="missionsMenu" class="menu">
        <div class="menu-content">
            <h2><i class="fas fa-flag-checkered"></i> ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</h2>
            <div id="missionsList" style="text-align: left; margin: 25px 0; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                <!-- Missions will be loaded here -->
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                <div style="background: rgba(0,106,78,0.3); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="color: #ffd700; font-size: 24px; font-weight: bold;">‡ßß‡ß´</div>
                    <div style="color: #ccc; font-size: 14px;">‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶ø‡¶∂‡¶®</div>
                </div>
                <div style="background: rgba(244,42,65,0.3); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="color: #00ff00; font-size: 24px; font-weight: bold;">‡ß©</div>
                    <div style="color: #ccc; font-size: 14px;">‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶Æ‡¶ø‡¶∂‡¶®</div>
                </div>
            </div>
            <button class="menu-button" id="missionsBackBtn">
                <i class="fas fa-arrow-left-long"></i> ‡¶™‡¶ø‡¶õ‡¶®‡ßá
            </button>
        </div>
    </div>

    <!-- INVENTORY MENU -->
    <div id="inventoryMenu" class="menu">
        <div class="menu-content">
            <h2><i class="fas fa-warehouse"></i> ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 25px 0;">
                <!-- Inventory items will be loaded here -->
            </div>
            <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px; margin: 20px 0;">
                <div style="color: #f42a41; font-size: 18px; margin-bottom: 10px;">‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞:</span>
                    <span style="color: #00a8ff;">‡ß´/‡ßß‡ß¶</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>‡¶π‡ßá‡¶≤‡¶• ‡¶ï‡¶ø‡¶ü:</span>
                    <span style="color: #00ff00;">‡ß©</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>‡¶Ü‡¶∞‡ßç‡¶Æ‡¶æ‡¶∞:</span>
                    <span style="color: #9b59b6;">‡ß®</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ:</span>
                    <span style="color: #ffd700;">‡ß≠</span>
                </div>
            </div>
            <button class="menu-button" id="inventoryBackBtn">
                <i class="fas fa-arrow-left-long"></i> ‡¶™‡¶ø‡¶õ‡¶®‡ßá
            </button>
        </div>
    </div>

    <!-- HELP MENU -->
    <div id="helpMenu" class="menu">
        <div class="menu-content">
            <h2><i class="fas fa-graduation-cap"></i> ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶Æ‡ßã‡¶°</h2>
            <div style="margin: 25px 0; line-height: 2; text-align: left; max-height: 400px; overflow-y: auto; padding-right: 15px;">
                <div style="background: rgba(0,106,78,0.2); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <div style="color: #f42a41; font-size: 20px; margin-bottom: 15px;">
                        <i class="fas fa-mobile-screen-button"></i> ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤
                    </div>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                        <div style="background: rgba(0,106,78,0.5); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-arrows-up-down-left-right"></i>
                        </div>
                        <div>
                            <div style="color: #00a8ff; font-weight: bold;">‡¶ú‡¶Ø‡¶º‡¶∏‡ßç‡¶ü‡¶ø‡¶ï</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶ö‡¶∞‡¶ø‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶ö‡¶≤‡¶æ‡¶ö‡¶≤</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-up-long"></i>
                        </div>
                        <div>
                            <div style="color: #00ff00; font-weight: bold;">‡¶≤‡¶æ‡¶´‡¶æ‡¶®</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶¨‡¶æ‡¶ß‡¶æ ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶â‡¶Å‡¶ö‡ßÅ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá ‡¶â‡¶†‡ßÅ‡¶®</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #c0392b, #e74c3c); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-crosshairs"></i>
                        </div>
                        <div>
                            <div style="color: #ff6b6b; font-weight: bold;">‡¶Ü‡¶ï‡ßç‡¶∞‡¶Æ‡¶£</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶∂‡¶§‡ßç‡¶∞‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶ï‡ßç‡¶∞‡¶Æ‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #2980b9, #3498db); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-handshake-angle"></i>
                        </div>
                        <div>
                            <div style="color: #74b9ff; font-weight: bold;">‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶ó‡¶æ‡¶°‡¶º‡¶ø, ‡¶¶‡¶∞‡¶ú‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶è‡¶®‡¶™‡¶ø‡¶∏‡¶ø ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #e67e22, #f39c12); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-repeat"></i>
                        </div>
                        <div>
                            <div style="color: #fdcb6e; font-weight: bold;">‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡ßç‡¶Ø‡ßÅ‡¶á‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #8e44ad, #9b59b6); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-gear"></i>
                        </div>
                        <div>
                            <div style="color: #a29bfe; font-weight: bold;">‡¶Æ‡ßá‡¶®‡ßÅ</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶ó‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶™‡¶∂‡¶®</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(244,42,65,0.1); padding: 20px; border-radius: 15px;">
                    <div style="color: #00a8ff; font-size: 20px; margin-bottom: 15px;">
                        <i class="fas fa-keyboard"></i> ‡¶™‡¶ø‡¶∏‡¶ø ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">W, A, S, D</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶ö‡¶≤‡¶æ‡¶ö‡¶≤</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">Space</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶≤‡¶æ‡¶´‡¶æ‡¶®</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">Shift</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶¶‡ßå‡¶°‡¶º‡¶æ‡¶®</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">Ctrl</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶¨‡¶∏‡ßÅ‡¶®/‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶π‡ßá‡¶≤‡ßÅ‡¶®</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">F</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶Ü‡¶ï‡ßç‡¶∞‡¶Æ‡¶£/‡¶ó‡ßÅ‡¶≤‡¶ø</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">E</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">1-8</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">ESC</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶™‡¶∏ ‡¶Æ‡ßá‡¶®‡ßÅ</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">Tab</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-weight: bold;">M</div>
                            <div style="color: #ccc; font-size: 14px;">‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶®/‡¶Ö‡¶´</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(0,168,255,0.1); padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <div style="color: #4cd137; font-size: 20px; margin-bottom: 15px;">
                        <i class="fas fa-lightbulb"></i> ‡¶ó‡ßá‡¶Æ‡¶ø‡¶Ç ‡¶ü‡¶ø‡¶™‡¶∏
                    </div>
                    <ul style="color: #ccc; padding-left: 20px;">
                        <li style="margin-bottom: 10px;">üí° ‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶¨‡ßá‡¶≤‡¶æ ‡¶Ü‡¶≤‡ßã‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º ‡¶Ø‡¶æ‡¶®, ‡¶¨‡¶ø‡¶™‡¶¶ ‡¶ï‡¶Æ</li>
                        <li style="margin-bottom: 10px;">üí° ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡ßç‡¶™‡¶ø‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡ßÅ‡¶®</li>
                        <li style="margin-bottom: 10px;">üí° ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá ‡¶ó‡¶ø‡¶Ø‡¶º‡ßá ‡¶π‡ßá‡¶≤‡¶• ‡¶ï‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</li>
                        <li style="margin-bottom: 10px;">üí° ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶ø ‡¶Ö‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                        <li style="margin-bottom: 10px;">üí° ‡¶ó‡ßã‡¶™‡¶® ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡¶æ‡¶®</li>
                        <li style="margin-bottom: 10px;">üí° ‡¶è‡¶®‡¶™‡¶ø‡¶∏‡¶ø ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    </ul>
                </div>
            </div>
            <button class="menu-button" id="helpBackBtn">
                <i class="fas fa-arrow-left-long"></i> ‡¶™‡¶ø‡¶õ‡¶®‡ßá
            </button>
        </div>
    </div>

    <!-- DEBUG INFO (Hidden by default) -->
    <div id="debugInfo"></div>

    <!-- THREE.JS LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/FXAAShader.min.js"></script>

    <!-- CANNON.js Physics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>

    <!-- TWEEN.js Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script>
        // GAME CONFIGURATION - UPGRADED VERSION
        const CONFIG = {
            gameName: "NAFIZ EMPIRE",
            version: "3.0.0",
            developer: "Bangladeshi Gaming Studio",
            player: {
                speed: 5.0,
                runSpeed: 8.0,
                jumpForce: 8.0,
                sensitivity: 0.002,
                fov: 75,
                height: 1.7,
                eyeHeight: 1.6
            },
            world: {
                size: 1500,
                buildings: 40,
                trees: 200,
                vehicles: 25,
                npcs: 40,
                detailLevel: 'medium'
            },
            graphics: {
                shadows: false,
                bloom: false,
                antialiasing: false,
                reflections: false,
                particles: true,
                weatherEffects: true
            }
        };

        // GAME STATE
        const gameState = {
            isLoaded: false,
            isPaused: false,
            gameStarted: false,
            firstPerson: true,
            debugMode: false,
            player: {
                health: 100,
                maxHealth: 100,
                stamina: 100,
                maxStamina: 100,
                armor: 0,
                maxArmor: 100,
                money: 10000,
                score: 2500,
                level: 1,
                experience: 0,
                position: { x: 0, y: 2, z: 0 },
                rotation: { x: 0, y: 0 },
                velocity: { x: 0, y: 0, z: 0 },
                isJumping: false,
                isRunning: false,
                isCrouching: false,
                currentWeapon: 0,
                weapons: [
                    { 
                        name: "‡¶è‡¶Æ-‡ßß‡ß¨ ‡¶∞‡¶æ‡¶á‡¶´‡ßá‡¶≤", 
                        damage: 35, 
                        icon: "fa-gun",
                        ammo: 30,
                        maxAmmo: 120,
                        fireRate: 0.1,
                        range: 100,
                        accuracy: 0.9
                    },
                    { 
                        name: "‡¶è‡¶ï‡ßá-‡ß™‡ß≠", 
                        damage: 30, 
                        icon: "fa-gun",
                        ammo: 30,
                        maxAmmo: 90,
                        fireRate: 0.15,
                        range: 80,
                        accuracy: 0.85
                    },
                    { 
                        name: "‡¶∏‡ßç‡¶®‡¶æ‡¶á‡¶™‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶á‡¶´‡ßá‡¶≤", 
                        damage: 80, 
                        icon: "fa-crosshairs",
                        ammo: 10,
                        maxAmmo: 30,
                        fireRate: 1.5,
                        range: 300,
                        accuracy: 0.95
                    },
                    { 
                        name: "‡¶™‡¶ø‡¶∏‡ßç‡¶§‡¶≤", 
                        damage: 25, 
                        icon: "fa-gun",
                        ammo: 12,
                        maxAmmo: 48,
                        fireRate: 0.3,
                        range: 50,
                        accuracy: 0.8
                    },
                    { 
                        name: "‡¶¨‡ßã‡¶Æ‡¶æ", 
                        damage: 100, 
                        icon: "fa-bomb",
                        ammo: 3,
                        maxAmmo: 9,
                        fireRate: 2.0,
                        range: 20,
                        accuracy: 0.7
                    }
                ],
                inventory: {
                    healthKits: 3,
                    armorKits: 2,
                    grenades: 5,
                    specialItems: []
                },
                inVehicle: false,
                currentVehicle: null,
                inBuilding: null,
                wantedLevel: 0
            },
            settings: {
                graphics: 'medium',
                controls: 'keyboard',
                sound: true,
                music: true,
                vibration: true,
                autoRun: true,
                aimAssist: true,
                language: 'bn'
            },
            world: {
                time: 11.5,
                isDay: true,
                weather: 'sunny',
                temperature: 28,
                humidity: 65,
                locations: [
                    { name: "‡¶¢‡¶æ‡¶ï‡¶æ ‡¶∏‡ßá‡¶®‡¶æ‡¶®‡¶ø‡¶¨‡¶æ‡¶∏", x: 0, z: 0, type: 'military', importance: 'high' },
                    { name: "‡¶∂‡ßá‡¶ñ ‡¶Æ‡ßÅ‡¶ú‡¶ø‡¶¨‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶∞‡ßç‡¶§‡¶ø", x: 300, z: 200, type: 'monument', importance: 'high' },
                    { name: "‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∏‡¶Ç‡¶∏‡¶¶ ‡¶≠‡¶¨‡¶®", x: -400, z: 100, type: 'government', importance: 'high' },
                    { name: "‡¶≤‡¶æ‡¶≤‡¶¨‡¶æ‡¶ó ‡¶ï‡ßá‡¶≤‡ßç‡¶≤‡¶æ", x: 200, z: -300, type: 'historical', importance: 'medium' },
                    { name: "‡¶Ü‡¶π‡¶∏‡¶æ‡¶® ‡¶Æ‡¶û‡ßç‡¶ú‡¶ø‡¶≤", x: -150, z: 350, type: 'historical', importance: 'medium' },
                    { name: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï", x: 450, z: -100, type: 'bank', importance: 'high' },
                    { name: "‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡¶æ‡¶π‡¶æ‡¶°‡¶º", x: 800, z: 800, type: 'nature', importance: 'medium' },
                    { name: "‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶® ‡¶¶‡ßç‡¶¨‡ßÄ‡¶™", x: 1200, z: -900, type: 'nature', importance: 'low' },
                    { name: "‡¶∏‡¶ø‡¶≤‡ßá‡¶ü ‡¶ö‡¶æ ‡¶¨‡¶æ‡¶ó‡¶æ‡¶®", x: -700, z: 600, type: 'nature', importance: 'medium' },
                    { name: "‡¶ï‡¶ï‡ßç‡¶∏‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞ ‡¶∏‡ßà‡¶ï‡¶§", x: 1000, z: -1200, type: 'nature', importance: 'high' }
                ]
            },
            missions: [
                { 
                    id: 1, 
                    title: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡¶¶‡¶ï‡ßç‡¶∑‡ßá‡¶™", 
                    description: "‡¶∂‡¶π‡¶∞‡ßá‡¶∞ ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶≤‡ßá ‡¶Ø‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ó‡¶æ‡¶á‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßÅ‡¶®",
                    completed: false, 
                    reward: 500, 
                    exp: 100,
                    progress: 0, 
                    target: 1,
                    type: 'tutorial',
                    location: { x: 0, z: 0 }
                },
                { 
                    id: 2, 
                    title: "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π", 
                    description: "‡ß≥ ‡ß´‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá",
                    completed: false, 
                    reward: 2000, 
                    exp: 250,
                    progress: 0, 
                    target: 50000,
                    type: 'money',
                    location: { x: 450, z: -100 }
                },
                { 
                    id: 3, 
                    title: "‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã", 
                    description: "‡ß´‡¶ü‡¶ø ‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶ö‡¶°‡¶º‡ßá ‡¶∂‡¶π‡¶∞ ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                    completed: false, 
                    reward: 800, 
                    exp: 150,
                    progress: 0, 
                    target: 5,
                    type: 'vehicle',
                    location: { x: 100, z: -200 }
                },
                { 
                    id: 4, 
                    title: "‡¶∂‡¶§‡ßç‡¶∞‡ßÅ ‡¶®‡¶ø‡¶ß‡¶®", 
                    description: "‡ß®‡ß¶‡¶ü‡¶ø ‡¶∂‡¶§‡ßç‡¶∞‡ßÅ ‡¶∏‡ßà‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡¶™‡¶æ‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®",
                    completed: false, 
                    reward: 1500, 
                    exp: 300,
                    progress: 0, 
                    target: 20,
                    type: 'combat',
                    location: { x: 0, z: 0 }
                },
                { 
                    id: 5, 
                    title: "‡¶ê‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶™‡¶∞‡¶ø‡¶¶‡¶∞‡ßç‡¶∂‡¶®", 
                    description: "‡¶∏‡¶¨ ‡¶ê‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶≠‡ßç‡¶∞‡¶Æ‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®",
                    completed: false, 
                    reward: 1200, 
                    exp: 200,
                    progress: 0, 
                    target: 3,
                    type: 'exploration',
                    location: { x: 200, z: -300 }
                }
            ],
            achievements: [
                { id: 1, title: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∞‡¶ï‡ßç‡¶§", description: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡¶§‡ßç‡¶∞‡ßÅ ‡¶¨‡¶ß", unlocked: false },
                { id: 2, title: "‡¶ß‡¶®‡¶ï‡ßÅ‡¶¨‡ßá‡¶∞", description: "‡ß≥ ‡ßß,‡ß¶‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π", unlocked: false },
                { id: 3, title: "‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶™‡ßç‡¶∞‡ßá‡¶Æ‡¶ø‡¶ï", description: "‡ßß‡ß¶‡¶ü‡¶ø ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶ï‡ßá‡¶®‡¶æ", unlocked: false },
                { id: 4, title: "‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßç‡¶≤‡ßã‡¶∞‡¶æ‡¶∞", description: "‡¶∏‡¶¨ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶Ü‡¶¨‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞", unlocked: false },
                { id: 5, title: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ", description: "‡ß´‡ß¶‡¶ü‡¶ø ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®", unlocked: false }
            ],
            collectibles: [],
            vehicles: [],
            npcs: [],
            buildings: [],
            particles: [],
            projectiles: []
        };

        // THREE.JS VARIABLES
        let scene, camera, renderer, controls, composer;
        let clock, deltaTime;
        let physicsWorld;
        let playerBody, playerMesh;
        let isPointerLocked = false;

        // INPUT MANAGEMENT
        const keys = {};
        const mouse = { x: 0, y: 0, dx: 0, dy: 0 };
        const touch = {
            joystick: { x: 0, y: 0, active: false },
            look: { x: 0, y: 0, active: false },
            buttons: {}
        };

        // GAME OBJECTS
        const gameObjects = {
            player: null,
            ground: null,
            skybox: null,
            lights: [],
            buildings: [],
            trees: [],
            vehicles: [],
            collectibles: [],
            npcs: [],
            particles: [],
            projectiles: [],
            effects: []
        };

        // LOADING FUNCTIONS
        async function initGame() {
            console.log('üöÄ NAFIZ EMPIRE - Ultimate Bangladeshi Open World Loading...');
            
            const loadingText = document.getElementById('loadingText');
            const loadingBar = document.getElementById('loadingBar');
            const tips = [
                "‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶´‡¶ø‡¶ú‡¶ø‡¶ï‡ßç‡¶∏ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶ñ‡ßá‡¶≤‡ßã‡¶Ø‡¶º‡¶æ‡¶°‡¶º ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶è‡¶Ü‡¶á ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡¶ø‡¶Ç...",
                "‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶Ö‡¶°‡¶ø‡¶ì ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...",
                "‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§! ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! üáßüá©"
            ];
            
            try {
                // Step 1: Initialize Three.js
                loadingText.textContent = tips[0];
                loadingBar.style.width = '10%';
                await initThreeJS();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 2: Initialize Physics
                loadingText.textContent = tips[1];
                loadingBar.style.width = '20%';
                await initPhysicsWorld();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 3: Create World
                loadingText.textContent = tips[2];
                loadingBar.style.width = '30%';
                await createWorld();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 4: Create Player
                loadingText.textContent = tips[3];
                loadingBar.style.width = '40%';
                await createPlayer();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 5: Create Environment
                loadingText.textContent = tips[4];
                loadingBar.style.width = '50%';
                await createEnvironment();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 6: Setup Controls
                loadingText.textContent = tips[5];
                loadingBar.style.width = '60%';
                await setupControls();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 7: Setup Event Listeners
                loadingText.textContent = tips[6];
                loadingBar.style.width = '70%';
                await setupEventListeners();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 8: Create Landmarks
                loadingText.textContent = tips[7];
                loadingBar.style.width = '80%';
                await createLandmarks();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Step 9: Try Audio
                loadingText.textContent = tips[8];
                loadingBar.style.width = '90%';
                try {
                    await initAudio();
                } catch (e) {
                    console.log("Audio initialization skipped:", e);
                }
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Final Step
                loadingText.textContent = tips[9];
                loadingBar.style.width = '100%';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Complete loading
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    gameState.isLoaded = true;
                    gameState.gameStarted = true;
                    
                    // Auto-detect device type
                    detectDeviceType();
                    
                    // Show welcome message
                    showNotification('üáßüá© NAFIZ EMPIRE ‡¶è ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡ßá‡¶∞‡¶æ ‡¶ì‡¶™‡ßá‡¶® ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶≤‡ßç‡¶° ‡¶ó‡ßá‡¶Æ‡¶ø‡¶Ç ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶∏!');
                    
                    // Show first mission
                    setTimeout(() => {
                        showMissionNotification('‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡¶¶‡¶ï‡ßç‡¶∑‡ßá‡¶™', '‡¶∂‡¶π‡¶∞‡ßá‡¶∞ ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶≤‡ßá ‡¶Ø‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ó‡¶æ‡¶á‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßÅ‡¶®');
                    }, 2000);
                    
                    // Start game loop
                    animate();
                }, 500);
                
            } catch (error) {
                console.error('Error during initialization:', error);
                loadingText.textContent = '‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá...';
                loadingBar.style.width = '100%';
                
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        gameState.isLoaded = true;
                        gameState.gameStarted = true;
                        showNotification('‡¶ó‡ßá‡¶Æ ‡¶≤‡ßã‡¶°‡ßá‡¶°! ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§');
                        detectDeviceType();
                        animate();
                    }, 500);
                }, 1000);
            }
        }
        
        function detectDeviceType() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            if (isMobile || (hasTouch && window.innerWidth < 768)) {
                // Mobile device
                gameState.settings.controls = 'touch';
                document.getElementById('controlType').value = 'touch';
                document.getElementById('mobileControls').style.display = 'flex';
            } else {
                // PC/Chromebook
                gameState.settings.controls = 'keyboard';
                document.getElementById('controlType').value = 'keyboard';
                document.getElementById('mobileControls').style.display = 'none';
                
                // Enable mouse controls
                setupMouseControls();
            }
        }
        
        function initThreeJS() {
            return new Promise((resolve, reject) => {
                try {
                    scene = new THREE.Scene();
                    scene.fog = new THREE.Fog(0x87ceeb, 100, 2000);
                    
                    camera = new THREE.PerspectiveCamera(
                        CONFIG.player.fov, 
                        window.innerWidth / window.innerHeight, 
                        0.1, 
                        3000
                    );
                    camera.position.set(0, CONFIG.player.eyeHeight, 0);
                    
                    renderer = new THREE.WebGLRenderer({ 
                        antialias: false,
                        alpha: true,
                        powerPreference: "high-performance"
                    });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.setPixelRatio(1);
                    renderer.shadowMap.enabled = false;
                    renderer.outputEncoding = THREE.sRGBEncoding;
                    document.getElementById('gameContainer').appendChild(renderer.domElement);
                    
                    composer = new THREE.EffectComposer(renderer);
                    const renderPass = new THREE.RenderPass(scene, camera);
                    composer.addPass(renderPass);
                    
                    window.addEventListener('resize', onWindowResize);
                    
                    clock = new THREE.Clock();
                    
                    controls = new THREE.PointerLockControls(camera, document.body);
                    
                    console.log("Three.js initialized successfully");
                    resolve();
                } catch (error) {
                    console.error("Three.js initialization failed:", error);
                    reject(error);
                }
            });
        }
        
        function initPhysicsWorld() {
            physicsWorld = new CANNON.World();
            physicsWorld.gravity.set(0, -9.82, 0);
            physicsWorld.broadphase = new CANNON.NaiveBroadphase();
            physicsWorld.solver.iterations = 8;
            
            const groundMaterial = new CANNON.Material("ground");
            const playerMaterial = new CANNON.Material("player");
            
            const playerGroundContact = new CANNON.ContactMaterial(
                playerMaterial,
                groundMaterial,
                {
                    friction: 0.5,
                    restitution: 0.3
                }
            );
            physicsWorld.addContactMaterial(playerGroundContact);
            
            return Promise.resolve();
        }
        
        function createWorld() {
            return new Promise((resolve, reject) => {
                try {
                    scene.background = new THREE.Color(0x87ceeb);
                    
                    const groundSize = CONFIG.world.size;
                    const groundGeometry = new THREE.PlaneGeometry(groundSize, groundSize, 32, 32);
                    
                    const vertices = groundGeometry.attributes.position.array;
                    for (let i = 0; i < vertices.length; i += 3) {
                        const x = vertices[i];
                        const z = vertices[i + 2];
                        
                        let height = 0;
                        const centerDistance = Math.sqrt(x * x + z * z);
                        height += Math.max(0, 50 - centerDistance / 10) * Math.random() * 0.3;
                        height += Math.sin(x * 0.01) * Math.cos(z * 0.01) * 15;
                        
                        vertices[i + 1] = height;
                    }
                    
                    groundGeometry.computeVertexNormals();
                    
                    const groundMaterial = new THREE.MeshStandardMaterial({
                        color: 0x00a86b,
                        roughness: 0.8,
                        metalness: 0.2
                    });
                    
                    gameObjects.ground = new THREE.Mesh(groundGeometry, groundMaterial);
                    gameObjects.ground.rotation.x = -Math.PI / 2;
                    scene.add(gameObjects.ground);
                    
                    const groundShape = new CANNON.Plane();
                    const groundBody = new CANNON.Body({ mass: 0 });
                    groundBody.addShape(groundShape);
                    groundBody.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
                    physicsWorld.addBody(groundBody);
                    
                    createRoads();
                    createLighting();
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function createRoads() {
            const roadMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x333333,
                roughness: 0.9,
                metalness: 0.1
            });
            
            const roads = [
                { start: { x: -500, z: 0 }, end: { x: 500, z: 0 }, width: 15 },
                { start: { x: 0, z: -500 }, end: { x: 0, z: 500 }, width: 15 }
            ];
            
            roads.forEach(road => {
                const length = Math.sqrt(
                    Math.pow(road.end.x - road.start.x, 2) + 
                    Math.pow(road.end.z - road.start.z, 2)
                );
                
                const roadGeometry = new THREE.PlaneGeometry(road.width, length);
                const roadMesh = new THREE.Mesh(roadGeometry, roadMaterial);
                
                roadMesh.position.set(
                    (road.start.x + road.end.x) / 2,
                    0.1,
                    (road.start.z + road.end.z) / 2
                );
                
                const angle = Math.atan2(road.end.z - road.start.z, road.end.x - road.start.x);
                roadMesh.rotation.y = -angle;
                roadMesh.rotation.x = -Math.PI / 2;
                
                scene.add(roadMesh);
            });
        }
        
        function createLighting() {
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const sunLight = new THREE.DirectionalLight(0xfff4e6, 1.0);
            sunLight.position.set(100, 200, 100);
            scene.add(sunLight);
            
            const hemiLight = new THREE.HemisphereLight(0x87ceeb, 0x006a4e, 0.4);
            scene.add(hemiLight);
            
            gameObjects.lights.push(ambientLight, sunLight, hemiLight);
        }
        
        function createPlayer() {
            return new Promise((resolve, reject) => {
                try {
                    const playerShape = new CANNON.Sphere(0.5);
                    playerBody = new CANNON.Body({ 
                        mass: 70,
                        material: new CANNON.Material({ friction: 0.3 })
                    });
                    playerBody.addShape(playerShape);
                    playerBody.position.set(0, 2, 0);
                    playerBody.linearDamping = 0.9;
                    playerBody.angularDamping = 0.9;
                    physicsWorld.addBody(playerBody);
                    
                    const playerGeometry = new THREE.SphereGeometry(0.5, 8, 8);
                    const playerMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0xf42a41,
                        roughness: 0.5,
                        metalness: 0.1
                    });
                    
                    playerMesh = new THREE.Mesh(playerGeometry, playerMaterial);
                    playerMesh.visible = false;
                    scene.add(playerMesh);
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function createEnvironment() {
            return new Promise((resolve, reject) => {
                try {
                    console.log('Creating Bangladeshi environment...');
                    
                    // Create realistic buildings
                    for (let i = 0; i < 25; i++) {
                        createRealisticBuilding(
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6,
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6,
                            ['house', 'apartment', 'shop'][Math.floor(Math.random() * 3)]
                        );
                    }
                    
                    // Create realistic trees
                    for (let i = 0; i < 150; i++) {
                        createRealisticTree(
                            (Math.random() - 0.5) * CONFIG.world.size * 0.7,
                            (Math.random() - 0.5) * CONFIG.world.size * 0.7
                        );
                    }
                    
                    // Create vehicles
                    for (let i = 0; i < 20; i++) {
                        createRealisticVehicle(
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6,
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6
                        );
                    }
                    
                    // Create NPCs with realistic faces
                    for (let i = 0; i < 30; i++) {
                        createRealisticNPC(
                            (Math.random() - 0.5) * CONFIG.world.size * 0.5,
                            (Math.random() - 0.5) * CONFIG.world.size * 0.5,
                            i < 10 ? 'enemy' : 'civilian'
                        );
                    }
                    
                    // Create collectibles
                    for (let i = 0; i < 30; i++) {
                        createCollectible(
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6,
                            (Math.random() - 0.5) * CONFIG.world.size * 0.6
                        );
                    }
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function createRealisticBuilding(x, z, type = 'house') {
            const buildingGroup = new THREE.Group();
            
            let width, depth, height;
            
            switch(type) {
                case 'house':
                    width = 8 + Math.random() * 4;
                    depth = 8 + Math.random() * 4;
                    height = 4 + Math.random() * 3;
                    break;
                case 'apartment':
                    width = 15 + Math.random() * 10;
                    depth = 12 + Math.random() * 8;
                    height = 8 + Math.random() * 12;
                    break;
                case 'shop':
                    width = 12 + Math.random() * 6;
                    depth = 10 + Math.random() * 6;
                    height = 5 + Math.random() * 4;
                    break;
                default:
                    width = 10;
                    depth = 10;
                    height = 6;
            }
            
            // Main structure
            const buildingGeometry = new THREE.BoxGeometry(width, height, depth);
            const buildingMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                roughness: 0.7,
                metalness: 0.1
            });
            
            const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
            building.position.y = height / 2;
            buildingGroup.add(building);
            
            // Roof
            const roofGeometry = new THREE.ConeGeometry(width * 0.8, height * 0.5, 4);
            const roofMaterial = new THREE.MeshStandardMaterial({
                color: 0x654321,
                roughness: 0.8
            });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = height + (height * 0.25);
            buildingGroup.add(roof);
            
            // Windows
            const windowMaterial = new THREE.MeshStandardMaterial({
                color: 0x87CEEB,
                emissive: 0x111111,
                emissiveIntensity: 0.2,
                transparent: true,
                opacity: 0.8
            });
            
            const windowCount = Math.floor(width / 3);
            for (let i = 0; i < windowCount; i++) {
                const windowGeometry = new THREE.PlaneGeometry(0.8, 1);
                const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                
                // Front windows
                windowMesh.position.set(
                    -width/2 + (i+1) * (width/(windowCount+1)),
                    height * 0.6,
                    depth/2 + 0.01
                );
                buildingGroup.add(windowMesh);
                
                // Back windows
                const backWindow = windowMesh.clone();
                backWindow.position.z = -depth/2 - 0.01;
                buildingGroup.add(backWindow);
            }
            
            // Door
            const doorGeometry = new THREE.BoxGeometry(1.2, 2, 0.2);
            const doorMaterial = new THREE.MeshStandardMaterial({
                color: 0x654321,
                roughness: 0.6
            });
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, 1, depth/2 + 0.1);
            buildingGroup.add(door);
            
            // Make door interactive
            door.userData = {
                isDoor: true,
                isOpen: false,
                canEnter: true
            };
            
            buildingGroup.position.set(x, 0, z);
            buildingGroup.rotation.y = Math.random() * Math.PI * 2;
            
            scene.add(buildingGroup);
            
            // Add collision body
            const buildingShape = new CANNON.Box(new CANNON.Vec3(width/2, height/2, depth/2));
            const buildingBody = new CANNON.Body({ mass: 0 });
            buildingBody.addShape(buildingShape);
            buildingBody.position.set(x, height/2, z);
            physicsWorld.addBody(buildingBody);
            
            gameObjects.buildings.push({ 
                mesh: buildingGroup, 
                body: buildingBody,
                door: door,
                type: type 
            });
            
            return buildingGroup;
        }
        
        function createRealisticTree(x, z) {
            const treeGroup = new THREE.Group();
            
            // Trunk
            const trunkHeight = 3 + Math.random() * 4;
            const trunkGeometry = new THREE.CylinderGeometry(0.4, 0.6, trunkHeight, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                roughness: 0.9
            });
            
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            treeGroup.add(trunk);
            
            // Leaves with multiple layers
            const leafColors = [0x228B22, 0x32CD32, 0x3CB371];
            
            for (let i = 0; i < 3; i++) {
                const leafSize = 2 + Math.random() * 1.5 - i * 0.5;
                const leafGeometry = new THREE.SphereGeometry(leafSize, 8, 7);
                const leafMaterial = new THREE.MeshStandardMaterial({
                    color: leafColors[i % leafColors.length],
                    roughness: 0.8,
                    transparent: true,
                    opacity: 0.9 - i * 0.1
                });
                
                const leaves = new THREE.Mesh(leafGeometry, leafMaterial);
                leaves.position.y = trunkHeight - leafSize/2 + 1 + i * 1.5;
                treeGroup.add(leaves);
                
                // Add some randomness to leaf positions
                leaves.position.x += (Math.random() - 0.5) * 0.5;
                leaves.position.z += (Math.random() - 0.5) * 0.5;
            }
            
            treeGroup.position.set(x, 0, z);
            
            // Add physics collision for trunk only
            const trunkShape = new CANNON.Cylinder(0.4, 0.6, trunkHeight);
            const trunkBody = new CANNON.Body({ mass: 0 });
            trunkBody.addShape(trunkShape);
            trunkBody.position.set(x, trunkHeight/2, z);
            physicsWorld.addBody(trunkBody);
            
            scene.add(treeGroup);
            gameObjects.trees.push({ mesh: treeGroup, body: trunkBody });
            
            return treeGroup;
        }
        
        function createRealisticVehicle(x, z) {
            const vehicleGroup = new THREE.Group();
            
            const width = 1.8;
            const height = 1.5;
            const depth = 4;
            
            // Main body
            const bodyGeometry = new THREE.BoxGeometry(width, height, depth);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: Math.random() > 0.5 ? 0x333333 : 0x006a4e,
                roughness: 0.5
            });
            
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            vehicleGroup.add(body);
            
            // Windshield
            const windshieldGeometry = new THREE.BoxGeometry(width * 0.9, 0.8, 0.1);
            const windshieldMaterial = new THREE.MeshStandardMaterial({
                color: 0x87CEEB,
                transparent: true,
                opacity: 0.5
            });
            const windshield = new THREE.Mesh(windshieldGeometry, windshieldMaterial);
            windshield.position.set(0, height/2 - 0.2, depth/2 - 0.3);
            vehicleGroup.add(windshield);
            
            // Wheels
            const wheelGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.2, 8);
            const wheelMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x000000,
                roughness: 0.8
            });
            
            const wheelPositions = [
                { x: -width/2 + 0.3, z: depth/3 },
                { x: width/2 - 0.3, z: depth/3 },
                { x: -width/2 + 0.3, z: -depth/3 },
                { x: width/2 - 0.3, z: -depth/3 }
            ];
            
            wheelPositions.forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.rotation.z = Math.PI / 2;
                wheel.position.set(pos.x, -height/2 + 0.3, pos.z);
                vehicleGroup.add(wheel);
            });
            
            vehicleGroup.position.set(x, height/2, z);
            vehicleGroup.rotation.y = Math.random() * Math.PI * 2;
            
            // Vehicle data
            const vehicleData = {
                mesh: vehicleGroup,
                type: 'car',
                speed: 2 + Math.random() * 3,
                direction: Math.random() * Math.PI * 2,
                userInVehicle: false,
                health: 100
            };
            
            scene.add(vehicleGroup);
            gameObjects.vehicles.push(vehicleData);
        }
        
        function createRealisticNPC(x, z, type = 'civilian') {
            const npcGroup = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.CapsuleGeometry(0.3, 1.4, 8, 8);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: type === 'enemy' ? 0x8B0000 : 0x2E8B57,
                roughness: 0.6,
                metalness: 0.1
            });
            
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            npcGroup.add(body);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 12);
            const headMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFCC99,
                roughness: 0.7,
                metalness: 0.0
            });
            
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.6;
            npcGroup.add(head);
            
            // Face details
            const faceGroup = new THREE.Group();
            
            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.05, 8, 6);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.08, 1.65, 0.2);
            faceGroup.add(leftEye);
            
            const rightEye = leftEye.clone();
            rightEye.position.x = 0.08;
            faceGroup.add(rightEye);
            
            // Mouth
            const mouthGeometry = new THREE.TorusGeometry(0.06, 0.02, 4, 8, Math.PI);
            const mouthMaterial = new THREE.MeshStandardMaterial({ color: 0x8B0000 });
            const mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
            mouth.position.set(0, 1.55, 0.2);
            mouth.rotation.x = Math.PI / 6;
            faceGroup.add(mouth);
            
            // Nose
            const noseGeometry = new THREE.ConeGeometry(0.03, 0.1, 4);
            const noseMaterial = new THREE.MeshStandardMaterial({ color: 0xFF9966 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0, 1.6, 0.25);
            nose.rotation.x = Math.PI / 2;
            faceGroup.add(nose);
            
            faceGroup.position.copy(head.position);
            npcGroup.add(faceGroup);
            
            // Clothing
            const shirtGeometry = new THREE.CylinderGeometry(0.32, 0.35, 0.6, 8);
            const shirtMaterial = new THREE.MeshStandardMaterial({
                color: type === 'enemy' ? 0x8B0000 : 0x1E90FF,
                roughness: 0.8
            });
            const shirt = new THREE.Mesh(shirtGeometry, shirtMaterial);
            shirt.position.y = 1.15;
            npcGroup.add(shirt);
            
            npcGroup.position.set(x, 0.9, z);
            
            // NPC data
            const npcData = {
                mesh: npcGroup,
                type: type,
                health: 100,
                speed: 0.5 + Math.random() * 0.8,
                direction: Math.random() * Math.PI * 2,
                state: 'idle',
                lastStateChange: 0,
                patrolPoints: [],
                awareness: 0,
                aggression: type === 'enemy' ? 0.8 : 0.1,
                dialogue: type === 'enemy' ? "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßá‡¶®?" : "‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ü‡¶õ‡ßá‡¶®?"
            };
            
            // Add patrol points
            for (let i = 0; i < 3; i++) {
                npcData.patrolPoints.push({
                    x: x + (Math.random() - 0.5) * 20,
                    z: z + (Math.random() - 0.5) * 20
                });
            }
            
            // Add physics body
            const npcShape = new CANNON.Capsule(0.3, 1.4);
            const npcBody = new CANNON.Body({ mass: 70 });
            npcBody.addShape(npcShape);
            npcBody.position.set(x, 1, z);
            npcBody.linearDamping = 0.9;
            physicsWorld.addBody(npcBody);
            
            npcData.physicsBody = npcBody;
            
            scene.add(npcGroup);
            gameObjects.npcs.push(npcData);
            
            return npcData;
        }
        
        function createCollectible(x, z) {
            const collectibleTypes = [
                { type: 'money', color: 0xFFD700, value: 100 },
                { type: 'health', color: 0xFF6B6B, value: 25 },
                { type: 'armor', color: 0x9B59B6, value: 30 },
                { type: 'ammo', color: 0x00A8FF, value: 10 }
            ];
            
            const collectibleType = collectibleTypes[Math.floor(Math.random() * collectibleTypes.length)];
            
            const geometry = new THREE.SphereGeometry(0.5, 8, 8);
            const material = new THREE.MeshStandardMaterial({
                color: collectibleType.color,
                roughness: 0.3,
                metalness: 0.7,
                emissive: collectibleType.color,
                emissiveIntensity: 0.2
            });
            
            const collectible = new THREE.Mesh(geometry, material);
            
            const y = 1 + Math.random() * 2;
            collectible.position.set(x, y, z);
            
            collectible.userData = {
                type: collectibleType.type,
                value: collectibleType.value,
                originalY: y,
                floatHeight: 0.3 + Math.random() * 0.3,
                collected: false
            };
            
            scene.add(collectible);
            gameObjects.collectibles.push(collectible);
        }
        
        function createLandmarks() {
            return new Promise((resolve, reject) => {
                try {
                    console.log('Creating Bangladeshi landmarks...');
                    
                    // Create monuments
                    createMonument(0, 0, 0x006a4e);
                    createMonument(-400, 100, 0xf42a41);
                    createMonument(200, -300, 0xffd700);
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function createMonument(x, z, color) {
            const monumentGroup = new THREE.Group();
            
            // Base
            const baseGeometry = new THREE.BoxGeometry(15, 2, 15);
            const baseMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.8
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 1;
            monumentGroup.add(base);
            
            // Monument
            const monumentGeometry = new THREE.CylinderGeometry(3, 2, 10, 8);
            const monumentMaterial = new THREE.MeshStandardMaterial({ 
                color: color,
                roughness: 0.5,
                metalness: 0.3
            });
            const monument = new THREE.Mesh(monumentGeometry, monumentMaterial);
            monument.position.y = 6;
            monumentGroup.add(monument);
            
            monumentGroup.position.set(x, 0, z);
            scene.add(monumentGroup);
        }
        
        function setupControls() {
            return new Promise((resolve, reject) => {
                try {
                    // Setup PC controls
                    setupPCControls();
                    
                    // Setup mobile controls
                    setupMobileControls();
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function setupPCControls() {
            console.log("Setting up PC controls...");
            
            // Keyboard controls mapping
            const keyMap = {
                'w': 'forward', 'arrowup': 'forward',
                's': 'backward', 'arrowdown': 'backward',
                'a': 'left', 'arrowleft': 'left',
                'd': 'right', 'arrowright': 'right',
                ' ': 'jump',
                'shift': 'run',
                'control': 'crouch',
                'e': 'interact',
                'f': 'attack',
                'r': 'reload',
                'q': 'leanleft',
                'c': 'crouch',
                '1': 'weapon1', '2': 'weapon2', '3': 'weapon3', '4': 'weapon4', '5': 'weapon5',
                'tab': 'map',
                'escape': 'menu',
                'm': 'map',
                'b': 'inventory'
            };
            
            // Key down
            document.addEventListener('keydown', (e) => {
                const key = e.key.toLowerCase();
                if (gameState.settings.controls === 'keyboard' && gameState.isLoaded && !gameState.isPaused) {
                    keys[key] = true;
                    
                    // Special actions
                    switch(key) {
                        case 'f':
                            performAttack();
                            break;
                        case 'e':
                            tryInteract();
                            break;
                        case ' ':
                            if (!gameState.player.isJumping) {
                                const ray = new CANNON.Ray(playerBody.position, new CANNON.Vec3(0, -1, 0));
                                const result = new CANNON.RaycastResult();
                                physicsWorld.rayTest(ray.origin, ray.to(new CANNON.Vec3(0, -2, 0)), result);
                                
                                if (result.hasHit && result.distance < 1.5) {
                                    playerBody.velocity.y = CONFIG.player.jumpForce;
                                    gameState.player.isJumping = true;
                                    setTimeout(() => { gameState.player.isJumping = false; }, 500);
                                }
                            }
                            break;
                        case 'escape':
                            toggleMenu();
                            break;
                        case '1': case '2': case '3': case '4': case '5':
                            const weaponIndex = parseInt(key) - 1;
                            if (weaponIndex < gameState.player.weapons.length) {
                                switchWeapon(weaponIndex);
                            }
                            break;
                        case 'r':
                            reloadWeapon();
                            break;
                        case 'tab':
                            toggleMinimap();
                            break;
                    }
                    
                    // Prevent default for game keys
                    if (['w', 'a', 's', 'd', ' ', 'shift', 'e', 'f', 'r'].includes(key)) {
                        e.preventDefault();
                    }
                }
            });
            
            // Key up
            document.addEventListener('keyup', (e) => {
                const key = e.key.toLowerCase();
                if (gameState.settings.controls === 'keyboard') {
                    keys[key] = false;
                }
            });
            
            // Mouse controls
            setupMouseControls();
            
            console.log("PC controls setup complete");
        }
        
        function setupMouseControls() {
            // Mouse movement
            document.addEventListener('mousemove', (e) => {
                if (isPointerLocked && gameState.settings.controls === 'keyboard' && !gameState.isPaused) {
                    mouse.dx = e.movementX || 0;
                    mouse.dy = e.movementY || 0;
                }
            });
            
            // Mouse click
            document.addEventListener('mousedown', (e) => {
                if (isPointerLocked && gameState.settings.controls === 'keyboard' && !gameState.isPaused) {
                    if (e.button === 0) { // Left click
                        performAttack();
                    } else if (e.button === 2) { // Right click - aim
                        camera.fov = camera.fov === CONFIG.player.fov ? 30 : CONFIG.player.fov;
                        camera.updateProjectionMatrix();
                    }
                }
            });
            
            // Context menu (right click)
            document.addEventListener('contextmenu', (e) => {
                if (gameState.settings.controls === 'keyboard') {
                    e.preventDefault();
                }
            });
            
            // Pointer lock
            document.addEventListener('click', () => {
                if (gameState.settings.controls === 'keyboard' && !gameState.isPaused && gameState.isLoaded) {
                    document.body.requestPointerLock();
                }
            });
            
            document.addEventListener('pointerlockchange', () => {
                isPointerLocked = document.pointerLockElement === document.body;
            });
        }
        
        function setupMobileControls() {
            // Touch joystick setup
            const joystick = document.getElementById('moveJoystick');
            const handle = joystick.querySelector('.joystick-handle');
            
            let joystickActive = false;
            let joystickCenter = { x: 0, y: 0 };
            
            joystick.addEventListener('touchstart', (e) => {
                if (gameState.settings.controls === 'touch') {
                    const rect = joystick.getBoundingClientRect();
                    joystickCenter.x = rect.left + rect.width / 2;
                    joystickCenter.y = rect.top + rect.height / 2;
                    joystickActive = true;
                    e.preventDefault();
                }
            });
            
            joystick.addEventListener('touchmove', (e) => {
                if (gameState.settings.controls === 'touch' && joystickActive) {
                    const touch = e.touches[0];
                    const dx = touch.clientX - joystickCenter.x;
                    const dy = touch.clientY - joystickCenter.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 60) {
                        touch.joystick.x = (dx / distance) * (60 / 40);
                        touch.joystick.y = (dy / distance) * (60 / 40);
                        handle.style.transform = `translate(-50%, -50%) translate(${(dx / distance) * 40}px, ${(dy / distance) * 40}px)`;
                    } else {
                        touch.joystick.x = dx / 40;
                        touch.joystick.y = dy / 40;
                        handle.style.transform = `translate(-50%, -50%) translate(${dx}px, ${dy}px)`;
                    }
                    
                    touch.joystick.active = true;
                    e.preventDefault();
                }
            });
            
            joystick.addEventListener('touchend', () => {
                if (gameState.settings.controls === 'touch') {
                    joystickActive = false;
                    touch.joystick.x = 0;
                    touch.joystick.y = 0;
                    touch.joystick.active = false;
                    handle.style.transform = 'translate(-50%, -50%)';
                }
            });
        }
        
        function setupEventListeners() {
            return new Promise((resolve, reject) => {
                try {
                    // Button event listeners
                    document.getElementById('resumeBtn').onclick = () => {
                        toggleMenu();
                    };
                    
                    document.getElementById('newGameBtn').onclick = () => {
                        if (confirm('‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡¶¨‡ßá‡•§')) {
                            location.reload();
                        }
                    };
                    
                    document.getElementById('loadGameBtn').onclick = () => {
                        loadGame();
                    };
                    
                    document.getElementById('settingsBtn').onclick = () => {
                        document.getElementById('mainMenu').style.display = 'none';
                        document.getElementById('settingsMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('missionsBtn').onclick = () => {
                        showMissions();
                        document.getElementById('mainMenu').style.display = 'none';
                        document.getElementById('missionsMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('inventoryBtn').onclick = () => {
                        showInventory();
                        document.getElementById('mainMenu').style.display = 'none';
                        document.getElementById('inventoryMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('helpBtn').onclick = () => {
                        document.getElementById('mainMenu').style.display = 'none';
                        document.getElementById('helpMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('backBtn').onclick = () => {
                        document.getElementById('settingsMenu').style.display = 'none';
                        document.getElementById('mainMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('missionsBackBtn').onclick = () => {
                        document.getElementById('missionsMenu').style.display = 'none';
                        document.getElementById('mainMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('inventoryBackBtn').onclick = () => {
                        document.getElementById('inventoryMenu').style.display = 'none';
                        document.getElementById('mainMenu').style.display = 'flex';
                    };
                    
                    document.getElementById('helpBackBtn').onclick = () => {
                        document.getElementById('helpMenu').style.display = 'none';
                        document.getElementById('mainMenu').style.display = 'flex';
                    };
                    
                    // Mobile action buttons
                    const setupMobileButton = (id, action) => {
                        const btn = document.getElementById(id);
                        btn.addEventListener('touchstart', () => {
                            touch.buttons[id] = true;
                            if (action) action();
                        });
                        btn.addEventListener('touchend', () => {
                            touch.buttons[id] = false;
                        });
                    };
                    
                    setupMobileButton('jumpBtn');
                    setupMobileButton('runBtn');
                    setupMobileButton('attackBtn', performAttack);
                    setupMobileButton('weaponBtn', () => {
                        switchWeapon((gameState.player.currentWeapon + 1) % gameState.player.weapons.length);
                    });
                    setupMobileButton('interactBtn', tryInteract);
                    setupMobileButton('menuBtn', toggleMenu);
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        function initAudio() {
            return Promise.resolve();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            if (composer) composer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // GAME LOGIC FUNCTIONS
        function updatePlayer() {
            if (!gameState.isLoaded || gameState.isPaused) return;
            
            const playerState = gameState.player;
            
            // Handle camera rotation
            if (gameState.firstPerson) {
                if (gameState.settings.controls === 'keyboard' && isPointerLocked) {
                    camera.rotation.y -= mouse.dx * CONFIG.player.sensitivity;
                    camera.rotation.x -= mouse.dy * CONFIG.player.sensitivity;
                    camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
                    
                    mouse.dx = mouse.dy = 0;
                } else if (gameState.settings.controls === 'touch' && touch.look.active) {
                    camera.rotation.y -= touch.look.x * CONFIG.player.sensitivity * 50;
                    camera.rotation.x -= touch.look.y * CONFIG.player.sensitivity * 50;
                    camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
                }
            }
            
            // Movement input
            let moveX = 0, moveZ = 0;
            
            if (gameState.settings.controls === 'keyboard') {
                if (keys['w'] || keys['arrowup']) moveZ = -1;
                if (keys['s'] || keys['arrowdown']) moveZ = 1;
                if (keys['a'] || keys['arrowleft']) moveX = -1;
                if (keys['d'] || keys['arrowright']) moveX = 1;
                
                playerState.isRunning = keys['shift'] || false;
                touch.buttons.jump = keys[' '] || false;
                touch.buttons.interact = keys['e'] || false;
            } else {
                moveX = touch.joystick.x;
                moveZ = touch.joystick.y;
                playerState.isRunning = touch.buttons.runBtn || false;
            }
            
            // Normalize diagonal movement
            if (moveX !== 0 || moveZ !== 0) {
                const length = Math.sqrt(moveX * moveX + moveZ * moveZ);
                moveX /= length;
                moveZ /= length;
            }
            
            // Calculate movement direction relative to camera
            const cameraDirection = new THREE.Vector3();
            camera.getWorldDirection(cameraDirection);
            cameraDirection.y = 0;
            cameraDirection.normalize();
            
            const cameraRight = new THREE.Vector3();
            cameraRight.crossVectors(camera.up, cameraDirection).normalize();
            
            // Calculate final movement vector
            const moveVector = new THREE.Vector3();
            moveVector.addScaledVector(cameraDirection, -moveZ);
            moveVector.addScaledVector(cameraRight, moveX);
            moveVector.normalize();
            
            // Apply movement speed
            const speed = playerState.isRunning ? CONFIG.player.runSpeed : CONFIG.player.speed;
            const moveDistance = speed * deltaTime * 60;
            
            // Update player physics body
            if (moveVector.length() > 0) {
                playerBody.velocity.x = moveVector.x * moveDistance * 10;
                playerBody.velocity.z = moveVector.z * moveDistance * 10;
            } else {
                // Apply friction
                playerBody.velocity.x *= 0.9;
                playerBody.velocity.z *= 0.9;
            }
            
            // Jump
            if ((touch.buttons.jump || keys[' ']) && !playerState.isJumping) {
                const ray = new CANNON.Ray(playerBody.position, new CANNON.Vec3(0, -1, 0));
                const result = new CANNON.RaycastResult();
                physicsWorld.rayTest(ray.origin, ray.to(new CANNON.Vec3(0, -2, 0)), result);
                
                if (result.hasHit && result.distance < 1.5) {
                    playerBody.velocity.y = CONFIG.player.jumpForce;
                    playerState.isJumping = true;
                    setTimeout(() => { playerState.isJumping = false; }, 500);
                    touch.buttons.jump = false;
                }
            }
            
            // Update player state from physics
            gameState.player.position.x = playerBody.position.x;
            gameState.player.position.y = playerBody.position.y;
            gameState.player.position.z = playerBody.position.z;
            
            // Update camera position to follow player
            camera.position.x = playerBody.position.x;
            camera.position.y = playerBody.position.y + CONFIG.player.eyeHeight;
            camera.position.z = playerBody.position.z;
            
            // Update player mesh
            playerMesh.position.copy(playerBody.position);
            
            // Stamina management
            if (playerState.isRunning && (moveX !== 0 || moveZ !== 0)) {
                playerState.stamina = Math.max(0, playerState.stamina - 20 * deltaTime);
                if (playerState.stamina === 0) {
                    playerState.isRunning = false;
                }
            } else {
                playerState.stamina = Math.min(playerState.maxStamina, playerState.stamina + 10 * deltaTime);
            }
            
            // Update UI
            updateUI();
            
            // Check collectibles
            checkCollectibles();
            
            // Update NPCs
            updateNPCs();
            
            // Update vehicles
            updateVehicles();
            
            // Update collectible animations
            updateCollectibleAnimations();
            
            // Update time
            updateTimeAndWeather();
            
            // Update minimap
            updateMinimap();
            
            // Update location display
            updateLocationDisplay();
            
            // Debug info
            if (gameState.debugMode) {
                updateDebugInfo();
            }
        }
        
        function updateNPCs() {
            const currentTime = clock.getElapsedTime();
            const playerPos = gameState.player.position;
            
            gameObjects.npcs.forEach(npc => {
                const mesh = npc.mesh;
                const npcPos = mesh.position;
                
                // Simple NPC behavior
                switch(npc.state) {
                    case 'idle':
                        if (currentTime - npc.lastStateChange > 3 + Math.random() * 5) {
                            npc.state = 'patrol';
                            npc.lastStateChange = currentTime;
                        }
                        break;
                        
                    case 'patrol':
                        if (npc.patrolPoints.length > 0) {
                            const target = npc.patrolPoints[0];
                            const dx = target.x - npcPos.x;
                            const dz = target.z - npcPos.z;
                            const distance = Math.sqrt(dx * dx + dz * dz);
                            
                            if (distance < 2) {
                                npc.patrolPoints.shift();
                                if (npc.patrolPoints.length === 0) {
                                    npc.state = 'idle';
                                    npc.lastStateChange = currentTime;
                                }
                            } else {
                                const direction = Math.atan2(dx, dz);
                                npcPos.x += Math.sin(direction) * npc.speed * deltaTime * 60;
                                npcPos.z += Math.cos(direction) * npc.speed * deltaTime * 60;
                                mesh.rotation.y = direction;
                            }
                        }
                        break;
                        
                    case 'chase':
                        if (npc.type === 'enemy') {
                            const dx = playerPos.x - npcPos.x;
                            const dz = playerPos.z - npcPos.z;
                            const distance = Math.sqrt(dx * dx + dz * dz);
                            const direction = Math.atan2(dx, dz);
                            
                            if (distance < 15) {
                                npcPos.x += Math.sin(direction) * npc.speed * 1.2 * deltaTime * 60;
                                npcPos.z += Math.cos(direction) * npc.speed * 1.2 * deltaTime * 60;
                                mesh.rotation.y = direction;
                                
                                if (distance < 2.5 && currentTime - npc.lastStateChange > 1.5) {
                                    damagePlayer(8);
                                    npc.lastStateChange = currentTime;
                                }
                            } else {
                                npc.state = 'idle';
                                npc.lastStateChange = currentTime;
                            }
                        }
                        break;
                }
                
                // Check awareness
                if (npc.type === 'enemy') {
                    const dx = playerPos.x - npcPos.x;
                    const dz = playerPos.z - npcPos.z;
                    const distance = Math.sqrt(dx * dx + dz * dz);
                    
                    if (distance < 20 && npc.state !== 'chase') {
                        npc.state = 'chase';
                        npc.lastStateChange = currentTime;
                    }
                }
                
                // Update NPC physics body
                if (npc.physicsBody) {
                    npc.physicsBody.position.set(npcPos.x, 1, npcPos.z);
                    mesh.position.copy(npc.physicsBody.position);
                }
            });
        }
        
        function updateVehicles() {
            gameObjects.vehicles.forEach(vehicle => {
                const mesh = vehicle.mesh;
                
                if (!vehicle.userInVehicle) {
                    // Simple autonomous movement
                    vehicle.direction += (Math.random() - 0.5) * 0.05;
                    
                    const moveX = Math.sin(vehicle.direction) * vehicle.speed * deltaTime * 60;
                    const moveZ = Math.cos(vehicle.direction) * vehicle.speed * deltaTime * 60;
                    
                    const newX = mesh.position.x + moveX;
                    const newZ = mesh.position.z + moveZ;
                    
                    // Boundary check
                    if (Math.abs(newX) > CONFIG.world.size * 0.3 || Math.abs(newZ) > CONFIG.world.size * 0.3) {
                        vehicle.direction += Math.PI;
                    } else {
                        mesh.position.x = newX;
                        mesh.position.z = newZ;
                    }
                    
                    mesh.rotation.y = vehicle.direction;
                } else {
                    // Player is in vehicle - follow player
                    mesh.position.x = playerBody.position.x;
                    mesh.position.z = playerBody.position.z;
                    mesh.rotation.y = camera.rotation.y;
                }
            });
        }
        
        function updateCollectibleAnimations() {
            const time = clock.getElapsedTime();
            
            gameObjects.collectibles.forEach(collectible => {
                if (collectible.userData.collected) return;
                
                const data = collectible.userData;
                
                // Float up and down
                collectible.position.y = data.originalY + Math.sin(time * 0.8) * data.floatHeight;
                
                // Rotate
                collectible.rotation.y += 0.01;
                
                // Pulsing glow
                const intensity = 0.2 + Math.sin(time * 2) * 0.1;
                collectible.material.emissiveIntensity = intensity;
            });
        }
        
        function updateTimeAndWeather() {
            gameState.world.time += deltaTime * 0.03;
            if (gameState.world.time >= 24) gameState.world.time = 0;
            
            gameState.world.isDay = gameState.world.time >= 6 && gameState.world.time < 18;
            
            updateTimeDisplay();
        }
        
        function checkCollectibles() {
            const playerPos = gameState.player.position;
            
            for (let i = gameObjects.collectibles.length - 1; i >= 0; i--) {
                const collectible = gameObjects.collectibles[i];
                if (collectible.userData.collected) continue;
                
                const dx = playerPos.x - collectible.position.x;
                const dz = playerPos.z - collectible.position.z;
                const dy = playerPos.y - collectible.position.y;
                const distance = Math.sqrt(dx * dx + dz * dz + dy * dy);
                
                if (distance < 1.5) {
                    collectItem(collectible);
                    collectible.userData.collected = true;
                    
                    // Visual effect
                    collectible.material.transparent = true;
                    collectible.material.opacity = 0.5;
                    
                    setTimeout(() => {
                        scene.remove(collectible);
                        gameObjects.collectibles.splice(i, 1);
                    }, 300);
                }
            }
        }
        
        function collectItem(collectible) {
            const data = collectible.userData;
            const playerState = gameState.player;
            
            switch(data.type) {
                case 'money':
                    playerState.money += data.value;
                    showNotification(`+‡ß≥${data.value} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                    updateMissionProgress(2, data.value);
                    break;
                    
                case 'health':
                    playerState.health = Math.min(playerState.maxHealth, playerState.health + data.value);
                    showNotification(`+${data.value} ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞!`);
                    break;
                    
                case 'armor':
                    playerState.armor = Math.min(playerState.maxArmor, playerState.armor + data.value);
                    showNotification(`+${data.value} ‡¶Ü‡¶∞‡ßç‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π!`);
                    break;
                    
                case 'ammo':
                    const weapon = playerState.weapons[playerState.currentWeapon];
                    weapon.ammo = Math.min(weapon.maxAmmo, weapon.ammo + data.value);
                    showNotification(`+${data.value} ‡¶è‡¶Æ‡ßç‡¶Æ‡ßã ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π!`);
                    updateWeaponDisplay();
                    break;
            }
        }
        
        function tryInteract() {
            const playerPos = gameState.player.position;
            
            // Check for vehicles
            let closestVehicle = null;
            let closestDistance = Infinity;
            
            gameObjects.vehicles.forEach(vehicle => {
                const distance = playerPos.distanceTo(vehicle.mesh.position);
                if (distance < 8 && distance < closestDistance) {
                    closestDistance = distance;
                    closestVehicle = vehicle;
                }
            });
            
            if (closestVehicle) {
                if (!gameState.player.inVehicle) {
                    // Enter vehicle
                    gameState.player.inVehicle = true;
                    gameState.player.currentVehicle = closestVehicle;
                    closestVehicle.userInVehicle = true;
                    showNotification('‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶â‡¶†‡¶≤‡ßá‡¶®! ‡¶ö‡¶≤‡¶æ‡¶ö‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø W, A, S, D ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®');
                    
                    // Update camera for vehicle
                    camera.position.y = 3;
                    
                    updateMissionProgress(3, 1);
                } else {
                    // Exit vehicle
                    gameState.player.inVehicle = false;
                    gameState.player.currentVehicle.userInVehicle = false;
                    gameState.player.currentVehicle = null;
                    showNotification('‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ‡¶≤‡ßá‡¶®');
                    
                    // Reset camera
                    camera.position.y = CONFIG.player.eyeHeight;
                }
                
                touch.buttons.interact = false;
                keys['e'] = false;
                return;
            }
            
            // Check for building doors
            let closestBuilding = null;
            closestDistance = Infinity;
            
            gameObjects.buildings.forEach(building => {
                if (building.door) {
                    const doorWorldPos = new THREE.Vector3();
                    building.door.getWorldPosition(doorWorldPos);
                    
                    const distance = playerPos.distanceTo(doorWorldPos);
                    if (distance < 3 && distance < closestDistance) {
                        closestDistance = distance;
                        closestBuilding = building;
                    }
                }
            });
            
            if (closestBuilding) {
                // Toggle door
                const door = closestBuilding.door;
                if (!door.userData.isOpen) {
                    // Open door
                    door.rotation.y = Math.PI / 2;
                    door.userData.isOpen = true;
                    showNotification("‡¶¶‡¶∞‡¶ú‡¶æ ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡¶≤‡ßã‡•§ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá E ‡¶ö‡¶æ‡¶™‡ßÅ‡¶® ‡¶Ü‡¶¨‡¶æ‡¶∞");
                } else {
                    // Enter/exit building
                    if (gameState.player.inBuilding === closestBuilding) {
                        // Exit building
                        playerBody.position.set(
                            closestBuilding.mesh.position.x + 2,
                            1,
                            closestBuilding.mesh.position.z + 2
                        );
                        gameState.player.inBuilding = null;
                        showNotification("‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶ø‡¶Ç ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡¶®...");
                    } else {
                        // Enter building
                        const interiorPos = closestBuilding.mesh.position.clone();
                        interiorPos.y = 1;
                        playerBody.position.copy(interiorPos);
                        gameState.player.inBuilding = closestBuilding;
                        showNotification("‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶ø‡¶Ç-‡¶è‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®!");
                    }
                }
                touch.buttons.interact = false;
                keys['e'] = false;
                return;
            }
            
            // Check for NPCs
            gameObjects.npcs.forEach(npc => {
                if (npc.type === 'civilian') {
                    const distance = playerPos.distanceTo(npc.mesh.position);
                    if (distance < 4) {
                        showNotification(`‡¶®‡¶æ‡¶ó‡¶∞‡¶ø‡¶ï: "${npc.dialogue}"`);
                        touch.buttons.interact = false;
                        keys['e'] = false;
                        return;
                    }
                }
            });
            
            showNotification('‡¶ï‡ßã‡¶® ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶¨‡¶≤ ‡¶¨‡¶∏‡ßç‡¶§‡ßÅ ‡¶®‡ßá‡¶á');
            touch.buttons.interact = false;
            keys['e'] = false;
        }
        
        function performAttack() {
            if (gameState.isPaused || !gameState.isLoaded) return;
            
            const weapon = gameState.player.weapons[gameState.player.currentWeapon];
            
            // Check ammo
            if (weapon.ammo <= 0) {
                showNotification('‡¶è‡¶Æ‡ßç‡¶Æ‡ßã ‡¶∂‡ßá‡¶∑! ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            // Use ammo
            weapon.ammo--;
            
            // Show hit effect
            showHitEffect();
            
            // Camera recoil
            camera.rotation.x += 0.01;
            
            // Check for NPC hits
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            
            let hitNPC = null;
            let hitDistance = Infinity;
            
            gameObjects.npcs.forEach((npc, index) => {
                if (npc.type === 'enemy') {
                    const intersection = raycaster.intersectObject(npc.mesh, true);
                    if (intersection.length > 0) {
                        const distance = intersection[0].distance;
                        if (distance < hitDistance && distance < weapon.range) {
                            hitDistance = distance;
                            hitNPC = { npc, index };
                        }
                    }
                }
            });
            
            if (hitNPC) {
                // Hit enemy
                hitNPC.npc.health -= weapon.damage;
                
                // Show damage indicator
                const damageIndicator = document.createElement('div');
                damageIndicator.style.position = 'fixed';
                damageIndicator.style.top = '50%';
                damageIndicator.style.left = '50%';
                damageIndicator.style.transform = 'translate(-50%, -50%)';
                damageIndicator.style.color = '#ff0000';
                damageIndicator.style.fontSize = '24px';
                damageIndicator.style.fontWeight = 'bold';
                damageIndicator.textContent = `-${weapon.damage}`;
                damageIndicator.style.zIndex = '1000';
                damageIndicator.style.pointerEvents = 'none';
                document.body.appendChild(damageIndicator);
                
                setTimeout(() => {
                    document.body.removeChild(damageIndicator);
                }, 500);
                
                if (hitNPC.npc.health <= 0) {
                    // Enemy defeated
                    showNotification(`‡¶∂‡¶§‡ßç‡¶∞‡ßÅ ‡¶®‡¶ø‡¶™‡¶æ‡¶§! +‡ß≥500, +100 ‡¶∏‡ßç‡¶ï‡ßã‡¶∞`);
                    
                    // Remove NPC
                    scene.remove(hitNPC.npc.mesh);
                    if (hitNPC.npc.physicsBody) {
                        physicsWorld.removeBody(hitNPC.npc.physicsBody);
                    }
                    gameObjects.npcs.splice(hitNPC.index, 1);
                    
                    // Add rewards
                    gameState.player.money += 500;
                    gameState.player.score += 100;
                    
                    // Update mission progress
                    updateMissionProgress(4, 1);
                } else {
                    showNotification(`‡¶∂‡¶§‡ßç‡¶∞‡ßÅ ‡¶ï‡ßç‡¶∑‡¶§‡¶ø‡¶ó‡ßç‡¶∞‡¶∏‡ßç‡¶§!`);
                }
            }
            
            // Update UI
            updateWeaponDisplay();
            
            touch.buttons.attackBtn = false;
            keys['f'] = false;
        }
        
        function reloadWeapon() {
            const weapon = gameState.player.weapons[gameState.player.currentWeapon];
            const ammoNeeded = weapon.maxAmmo - weapon.ammo;
            
            if (ammoNeeded > 0) {
                weapon.ammo = weapon.maxAmmo;
                showNotification(`${weapon.name} ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                updateWeaponDisplay();
            } else {
                showNotification('‡¶è‡¶Æ‡ßç‡¶Æ‡ßã ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶õ‡ßá!');
            }
        }
        
        function switchWeapon(index) {
            if (index < gameState.player.weapons.length) {
                gameState.player.currentWeapon = index;
                const weapon = gameState.player.weapons[index];
                showNotification(`‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ${weapon.name}`);
                updateWeaponDisplay();
            }
        }
        
        function damagePlayer(amount) {
            // Apply damage to armor first
            let damageToHealth = amount;
            
            if (gameState.player.armor > 0) {
                const armorDamage = Math.min(gameState.player.armor, amount * 0.7);
                gameState.player.armor -= armorDamage;
                damageToHealth = amount - armorDamage;
            }
            
            // Apply remaining damage to health
            gameState.player.health = Math.max(0, gameState.player.health - damageToHealth);
            
            // Show hit effect
            showHitEffect();
            
            // Screen shake
            cameraShake(0.3);
            
            if (gameState.player.health <= 0) {
                gameOver();
            }
        }
        
        function cameraShake(intensity) {
            const originalPosition = camera.position.clone();
            const shakeDuration = 200;
            
            let elapsed = 0;
            const animateShake = () => {
                elapsed += 16;
                const progress = elapsed / shakeDuration;
                
                if (progress < 1) {
                    const shakeAmount = intensity * (1 - progress);
                    camera.position.x = originalPosition.x + (Math.random() - 0.5) * shakeAmount;
                    camera.position.y = originalPosition.y + (Math.random() - 0.5) * shakeAmount;
                    camera.position.z = originalPosition.z + (Math.random() - 0.5) * shakeAmount;
                    
                    requestAnimationFrame(animateShake);
                } else {
                    camera.position.copy(originalPosition);
                }
            };
            
            animateShake();
        }
        
        function gameOver() {
            showNotification('‡¶ó‡ßá‡¶Æ ‡¶ì‡¶≠‡¶æ‡¶∞! ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡¶®...');
            gameState.isPaused = true;
            
            setTimeout(() => {
                playerBody.position.set(0, 2, 0);
                playerBody.velocity.set(0, 0, 0);
                gameState.player.health = gameState.player.maxHealth;
                gameState.player.armor = 0;
                gameState.isPaused = false;
                showNotification('‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶õ‡¶æ‡¶°‡¶º‡¶™‡¶§‡ßç‡¶∞! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®');
            }, 3000);
        }
        
        // UI FUNCTIONS
        function updateUI() {
            const playerState = gameState.player;
            
            // Update health bar
            const healthPercent = (playerState.health / playerState.maxHealth) * 100;
            document.getElementById('healthBar').style.width = `${healthPercent}%`;
            document.getElementById('healthValue').textContent = `${Math.round(healthPercent)}%`;
            
            // Update stamina bar
            const staminaPercent = (playerState.stamina / playerState.maxStamina) * 100;
            document.getElementById('staminaBar').style.width = `${staminaPercent}%`;
            document.getElementById('staminaValue').textContent = `${Math.round(staminaPercent)}%`;
            
            // Update armor bar
            const armorPercent = (playerState.armor / playerState.maxArmor) * 100;
            document.getElementById('armorBar').style.width = `${armorPercent}%`;
            document.getElementById('armorValue').textContent = `${Math.round(armorPercent)}%`;
            
            // Update money
            document.getElementById('money').textContent = `‡ß≥ ${playerState.money.toLocaleString()}`;
            
            // Update score
            document.getElementById('score').textContent = `${playerState.score.toLocaleString()}`;
            
            // Update weapon display
            updateWeaponDisplay();
        }
        
        function updateWeaponDisplay() {
            const weapon = gameState.player.weapons[gameState.player.currentWeapon];
            document.getElementById('weaponName').textContent = weapon.name;
            document.getElementById('ammoCount').textContent = `${weapon.ammo}/${weapon.maxAmmo}`;
        }
        
        function updateTimeDisplay() {
            const hour = Math.floor(gameState.world.time);
            const minute = Math.floor((gameState.world.time % 1) * 60);
            const period = hour < 12 ? '‡¶∏‡¶ï‡¶æ‡¶≤' : hour < 18 ? '‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞' : '‡¶∞‡¶æ‡¶§';
            
            document.getElementById('timeText').textContent = 
                `${period} ${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            
            const timeIcon = document.querySelector('#timeDisplay i');
            if (gameState.world.isDay) {
                timeIcon.className = 'fas fa-sun';
                timeIcon.style.color = '#FFD700';
            } else {
                timeIcon.className = 'fas fa-moon';
                timeIcon.style.color = '#00A8FF';
            }
        }
        
        function updateLocationDisplay() {
            const playerPos = gameState.player.position;
            let closestLocation = gameState.world.locations[0];
            let closestDistance = Infinity;
            
            gameState.world.locations.forEach(location => {
                const dx = playerPos.x - location.x;
                const dz = playerPos.z - location.z;
                const distance = Math.sqrt(dx * dx + dz * dz);
                
                if (distance < closestDistance) {
                    closestDistance = distance;
                    closestLocation = location;
                }
            });
            
            if (closestDistance < 150) {
                document.getElementById('locationName').textContent = closestLocation.name;
            }
        }
        
        function updateMinimap() {
            const playerDot = document.querySelector('.mini-map-player');
            if (!playerDot) return;
            
            const playerPos = gameState.player.position;
            
            const mapSize = 180;
            const worldSize = CONFIG.world.size * 0.6;
            
            const mapX = (playerPos.x / worldSize) * (mapSize * 0.9) + (mapSize / 2);
            const mapY = (playerPos.z / worldSize) * (mapSize * 0.9) + (mapSize / 2);
            
            playerDot.style.left = `${mapX}px`;
            playerDot.style.top = `${mapY}px`;
        }
        
        function toggleMinimap() {
            const minimap = document.getElementById('miniMap');
            minimap.style.display = minimap.style.display === 'none' ? 'block' : 'none';
        }
        
        function updateMissionProgress(missionId, amount) {
            const mission = gameState.missions.find(m => m.id === missionId);
            if (mission && !mission.completed) {
                mission.progress += amount;
                
                if (mission.progress >= mission.target) {
                    mission.completed = true;
                    mission.progress = mission.target;
                    gameState.player.money += mission.reward;
                    gameState.player.experience += mission.exp;
                    
                    // Level up check
                    if (gameState.player.experience >= gameState.player.level * 100) {
                        gameState.player.level++;
                        gameState.player.experience = 0;
                        showNotification(`‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶Ü‡¶™! ‡¶è‡¶ñ‡¶® ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ${gameState.player.level}`);
                    }
                    
                    showNotification(`‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! +‡ß≥${mission.reward} ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞`);
                    showAchievementPopup(mission.title);
                }
            }
        }
        
        function showMissions() {
            const missionsList = document.getElementById('missionsList');
            missionsList.innerHTML = '';
            
            gameState.missions.forEach(mission => {
                const progressPercent = (mission.progress / mission.target) * 100;
                const missionElement = document.createElement('div');
                missionElement.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.4), rgba(20,20,40,0.4))';
                missionElement.style.padding = '15px';
                missionElement.style.margin = '10px 0';
                missionElement.style.borderRadius = '12px';
                missionElement.style.border = '2px solid ' + (mission.completed ? '#00ff00' : '#f42a41');
                
                missionElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: bold; font-size: 16px; color: ${mission.completed ? '#00ff00' : '#f42a41'};">
                            ${mission.title} ${mission.completed ? '‚úì' : ''}
                        </div>
                        <div style="background: ${mission.completed ? '#00ff00' : '#f42a41'}; color: white; padding: 3px 8px; border-radius: 8px; font-size: 12px;">
                            ${mission.type}
                        </div>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 10px; color: #ccc;">
                        ${mission.description}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1; margin-right: 15px;">
                            <div style="width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${progressPercent}%; height: 100%; background: ${mission.completed ? '#00ff00' : '#f42a41'};"></div>
                            </div>
                        </div>
                        <div style="font-size: 14px; color: #f1c40f;">
                            ${Math.round(mission.progress)}/${mission.target}
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #ccc; font-size: 12px;">
                        <div>
                            <i class="fas fa-money-bill-wave"></i>
                            ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ‡ß≥${mission.reward}
                        </div>
                        <div>
                            <i class="fas fa-star"></i>
                            ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶ø: ${mission.exp}
                        </div>
                    </div>
                `;
                
                missionsList.appendChild(missionElement);
            });
        }
        
        function showInventory() {
            const inventoryMenu = document.getElementById('inventoryMenu');
            const inventoryGrid = inventoryMenu.querySelector('div[style*="grid-template-columns"]');
            inventoryGrid.innerHTML = '';
            
            gameState.player.weapons.forEach((weapon, index) => {
                const itemElement = document.createElement('div');
                itemElement.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.5), rgba(40,40,60,0.5))';
                itemElement.style.padding = '12px';
                itemElement.style.borderRadius = '10px';
                itemElement.style.textAlign = 'center';
                itemElement.style.border = index === gameState.player.currentWeapon ? 
                    '2px solid #f42a41' : '1px solid #444';
                itemElement.style.cursor = 'pointer';
                
                itemElement.innerHTML = `
                    <div style="font-size: 28px; color: #f42a41; margin-bottom: 8px;">
                        <i class="fas ${weapon.icon}"></i>
                    </div>
                    <div style="font-weight: bold; margin-bottom: 5px; font-size: 14px;">${weapon.name}</div>
                    <div style="font-size: 11px; color: #ccc;">
                        ‡¶è‡¶Æ‡ßç‡¶Æ‡ßã: ${weapon.ammo}/${weapon.maxAmmo}
                    </div>
                `;
                
                itemElement.onclick = () => {
                    switchWeapon(index);
                    showNotification(`‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü: ${weapon.name}`);
                };
                
                inventoryGrid.appendChild(itemElement);
            });
        }
        
        function showNotification(text, subtitle = '') {
            const notification = document.getElementById('missionNotification');
            const missionText = document.getElementById('missionText');
            
            missionText.textContent = text;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function showMissionNotification(title, text) {
            showNotification(text);
        }
        
        function showAchievementPopup(title) {
            const popup = document.getElementById('achievementPopup');
            const achievementText = document.getElementById('achievementText');
            
            achievementText.textContent = title;
            popup.style.display = 'block';
            
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }
        
        function showHitEffect() {
            const hitEffect = document.getElementById('hitEffect');
            hitEffect.style.opacity = '0.6';
            
            setTimeout(() => {
                hitEffect.style.opacity = '0';
            }, 100);
        }
        
        function toggleMenu() {
            gameState.isPaused = !gameState.isPaused;
            const mainMenu = document.getElementById('mainMenu');
            mainMenu.style.display = gameState.isPaused ? 'flex' : 'none';
            
            const mobileControls = document.getElementById('mobileControls');
            mobileControls.style.display = gameState.isPaused ? 'none' : 'flex';
            
            if (gameState.isPaused && isPointerLocked) {
                document.exitPointerLock();
            }
            
            // Show/hide controls based on device
            if (!gameState.isPaused) {
                detectDeviceType();
            }
        }
        
        function saveSettings() {
            const graphicsQuality = document.getElementById('graphicsQuality').value;
            const controlType = document.getElementById('controlType').value;
            
            gameState.settings.graphics = graphicsQuality;
            gameState.settings.controls = controlType;
            
            // Apply control settings
            if (controlType === 'touch') {
                document.getElementById('mobileControls').style.display = 'flex';
            } else {
                document.getElementById('mobileControls').style.display = 'none';
                setupMouseControls();
            }
            
            document.getElementById('settingsMenu').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'flex';
            
            showNotification('‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }
        
        function saveGame() {
            const saveData = {
                player: gameState.player,
                missions: gameState.missions,
                achievements: gameState.achievements,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('nafizEmpireSave', JSON.stringify(saveData));
            showNotification('‡¶ó‡ßá‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }
        
        function loadGame() {
            const saveData = localStorage.getItem('nafizEmpireSave');
            if (saveData) {
                const parsed = JSON.parse(saveData);
                
                gameState.player = { ...gameState.player, ...parsed.player };
                gameState.missions = parsed.missions;
                gameState.achievements = parsed.achievements;
                
                showNotification('‡¶ó‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                toggleMenu();
            } else {
                showNotification('‡¶ï‡ßã‡¶® ‡¶∏‡ßá‡¶≠ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
            }
        }
        
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const player = gameState.player;
            const fps = Math.round(1 / deltaTime);
            
            debugInfo.innerHTML = `
                <div>FPS: ${fps}</div>
                <div>Position: ${player.position.x.toFixed(1)}, ${player.position.y.toFixed(1)}, ${player.position.z.toFixed(1)}</div>
                <div>Health: ${player.health}/${player.maxHealth}</div>
                <div>Money: ‡ß≥${player.money}</div>
                <div>Weapon: ${player.weapons[player.currentWeapon].name}</div>
                <div>Time: ${gameState.world.time.toFixed(2)}</div>
            `;
        }
        
        // ANIMATION LOOP
        function animate() {
            requestAnimationFrame(animate);
            
            deltaTime = clock.getDelta();
            
            if (gameState.isLoaded && !gameState.isPaused) {
                // Update physics
                physicsWorld.step(1/60, deltaTime, 2);
                
                // Update game logic
                updatePlayer();
                
                // Render
                renderer.render(scene, camera);
            } else {
                // Still render when paused
                renderer.render(scene, camera);
            }
        }
        
        // START THE GAME
        document.addEventListener('DOMContentLoaded', () => {
            const loadingTimeout = setTimeout(() => {
                if (!gameState.isLoaded) {
                    console.log("Loading timeout - forcing game start");
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        gameState.isLoaded = true;
                        gameState.gameStarted = true;
                        showNotification('‡¶ó‡ßá‡¶Æ ‡¶≤‡ßã‡¶°‡ßá‡¶° (‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶Æ‡ßã‡¶°)!');
                        
                        detectDeviceType();
                        animate();
                    }, 500);
                }
            }, 15000);
            
            // Start game initialization
            initGame().then(() => {
                clearTimeout(loadingTimeout);
            }).catch((error) => {
                console.error("Game initialization failed:", error);
                clearTimeout(loadingTimeout);
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    gameState.isLoaded = true;
                    gameState.gameStarted = true;
                    showNotification('‡¶ó‡ßá‡¶Æ ‡¶≤‡ßã‡¶°‡ßá‡¶°! ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§');
                    detectDeviceType();
                    animate();
                }, 500);
            });
        });
        
        // Prevent drag and drop
        document.addEventListener('dragstart', (e) => e.preventDefault());
        document.addEventListener('drop', (e) => e.preventDefault());
    </script>
</body>
</html>
