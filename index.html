<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAFIZ EMPIRE - Bangladeshi Open World</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { overflow: hidden; font-family: 'Orbitron', sans-serif; background: #000; color: white; }
        
        #loadingScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex; justify-content: center;
            align-items: center; flex-direction: column;
        }
        
        .loader {
            width: 80px; height: 80px; border: 8px solid #f42a41;
            border-top: 8px solid transparent; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #gameContainer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        }
        
        canvas { display: block; }
        
        #hud {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
        }
        
        .hud-stat {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px;
            border-left: 4px solid #f42a41; min-width: 150px;
        }
        
        .stat-bar {
            width: 100%; height: 10px; background: rgba(255,255,255,0.1);
            border-radius: 5px; margin-top: 5px; overflow: hidden;
        }
        
        .stat-fill {
            height: 100%; border-radius: 5px; transition: width 0.3s;
        }
        
        #healthBar { background: #f42a41; }
        #staminaBar { background: #00ff00; }
        
        #mobileControls {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; z-index: 200;
        }
        
        .joystick-area {
            width: 120px; height: 120px; background: rgba(0,106,78,0.5);
            border-radius: 50%; border: 3px solid #f42a41;
            position: relative;
        }
        
        .joystick-handle {
            width: 50px; height: 50px; background: #f42a41;
            border-radius: 50%; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        
        .action-button {
            width: 70px; height: 70px; background: #f42a41;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 24px; color: white;
            border: 3px solid white; pointer-events: auto;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <h1 style="color: #f42a41; margin-bottom: 20px;">NAFIZ EMPIRE</h1>
        <div class="loader"></div>
        <div id="loadingText" style="margin-top: 20px;">Loading...</div>
    </div>
    
    <div id="gameContainer"></div>
    
    <div id="hud">
        <div class="hud-stat">
            <div>HEALTH</div>
            <div id="healthValue">100%</div>
            <div class="stat-bar">
                <div id="healthBar" class="stat-fill" style="width: 100%"></div>
            </div>
        </div>
    </div>
    
    <div id="mobileControls">
        <div class="joystick-area" id="joystickArea">
            <div class="joystick-handle" id="joystickHandle"></div>
        </div>
        <div style="display: flex; gap: 15px;">
            <div class="action-button" id="jumpBtn">↑</div>
            <div class="action-button" id="attackBtn">⚔️</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // SIMPLE WORKING 3D GAME
        console.log("Starting NAFIZ EMPIRE...");
        
        let scene, camera, renderer, controls;
        let clock = new THREE.Clock();
        let deltaTime = 0;
        
        // Game State
        const gameState = {
            loaded: false,
            paused: false,
            player: {
                health: 100,
                stamina: 100,
                money: 10000,
                position: new THREE.Vector3(0, 2, 5)
            },
            controls: {
                joystickX: 0,
                joystickY: 0
            }
        };
        
        // Initialize Game
        async function initGame() {
            console.log("Initializing game...");
            
            // Update loading
            document.getElementById('loadingText').textContent = "Initializing 3D Engine...";
            
            // Create Scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x87ceeb, 10, 1000);
            
            // Create Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 5);
            
            // Create Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            document.getElementById('gameContainer').appendChild(renderer.domElement);
            
            // Add Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create Ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x3a5f0b });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Create Sky
            const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
            const skyMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x87ceeb, 
                side: THREE.BackSide 
            });
            const sky = new THREE.Mesh(skyGeometry, skyMaterial);
            scene.add(sky);
            
            // Create Player
            const playerGeometry = new THREE.CapsuleGeometry(0.5, 2, 8, 16);
            const playerMaterial = new THREE.MeshLambertMaterial({ color: 0xf42a41 });
            const player = new THREE.Mesh(playerGeometry, playerMaterial);
            player.castShadow = true;
            scene.add(player);
            gameState.player.mesh = player;
            
            // Create Bangladeshi Buildings
            createBuilding(-10, 0, -10);
            createBuilding(10, 0, -10);
            createBuilding(-10, 0, 10);
            createBuilding(10, 0, 10);
            
            // Create Trees
            for(let i = 0; i < 20; i++) {
                createTree(
                    Math.random() * 80 - 40,
                    0,
                    Math.random() * 80 - 40
                );
            }
            
            // Create Road
            const roadGeometry = new THREE.PlaneGeometry(20, 100);
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.rotation.x = -Math.PI / 2;
            road.position.y = 0.1;
            scene.add(road);
            
            // Setup Controls
            setupControls();
            
            // Window Resize
            window.addEventListener('resize', onWindowResize);
            
            // Complete Loading
            document.getElementById('loadingText').textContent = "Game Ready!";
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    gameState.loaded = true;
                    animate();
                }, 500);
            }, 1000);
        }
        
        function createBuilding(x, y, z) {
            const group = new THREE.Group();
            
            // Base
            const baseGeometry = new THREE.BoxGeometry(8, 10, 8);
            const baseMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 5;
            base.castShadow = true;
            group.add(base);
            
            // Roof
            const roofGeometry = new THREE.ConeGeometry(6, 4, 4);
            const roofMaterial = new THREE.MeshLambertMaterial({ color: 0x8B0000 });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = 12;
            group.add(roof);
            
            group.position.set(x, y, z);
            scene.add(group);
            
            return group;
        }
        
        function createTree(x, y, z) {
            const group = new THREE.Group();
            
            // Trunk
            const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.7, 5, 8);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.castShadow = true;
            group.add(trunk);
            
            // Leaves
            const leavesGeometry = new THREE.SphereGeometry(3, 8, 8);
            const leavesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
            leaves.position.y = 4;
            leaves.castShadow = true;
            group.add(leaves);
            
            group.position.set(x, y, z);
            scene.add(group);
            
            return group;
        }
        
        function setupControls() {
            // Joystick
            const joystickArea = document.getElementById('joystickArea');
            const joystickHandle = document.getElementById('joystickHandle');
            
            let isJoystickActive = false;
            let joystickStartX = 0, joystickStartY = 0;
            
            joystickArea.addEventListener('touchstart', (e) => {
                isJoystickActive = true;
                const rect = joystickArea.getBoundingClientRect();
                joystickStartX = rect.left + rect.width / 2;
                joystickStartY = rect.top + rect.height / 2;
                e.preventDefault();
            });
            
            joystickArea.addEventListener('touchmove', (e) => {
                if(!isJoystickActive) return;
                
                const touch = e.touches[0];
                const dx = touch.clientX - joystickStartX;
                const dy = touch.clientY - joystickStartY;
                const distance = Math.sqrt(dx*dx + dy*dy);
                const maxDistance = 40;
                
                if(distance > maxDistance) {
                    gameState.controls.joystickX = (dx / distance) * (maxDistance / 40);
                    gameState.controls.joystickY = (dy / distance) * (maxDistance / 40);
                    joystickHandle.style.transform = `translate(-50%, -50%) translate(${(dx/distance)*maxDistance}px, ${(dy/distance)*maxDistance}px)`;
                } else {
                    gameState.controls.joystickX = dx / 40;
                    gameState.controls.joystickY = dy / 40;
                    joystickHandle.style.transform = `translate(-50%, -50%) translate(${dx}px, ${dy}px)`;
                }
                
                e.preventDefault();
            });
            
            joystickArea.addEventListener('touchend', () => {
                isJoystickActive = false;
                gameState.controls.joystickX = 0;
                gameState.controls.joystickY = 0;
                joystickHandle.style.transform = 'translate(-50%, -50%)';
            });
            
            // Action Buttons
            document.getElementById('jumpBtn').addEventListener('touchstart', () => {
                if(gameState.player.mesh) {
                    gameState.player.mesh.position.y += 2;
                    setTimeout(() => {
                        gameState.player.mesh.position.y -= 2;
                    }, 500);
                }
            });
            
            document.getElementById('attackBtn').addEventListener('touchstart', () => {
                gameState.player.health -= 10;
                updateHealth();
            });
            
            // Keyboard Controls
            document.addEventListener('keydown', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'w': gameState.controls.joystickY = -1; break;
                    case 's': gameState.controls.joystickY = 1; break;
                    case 'a': gameState.controls.joystickX = -1; break;
                    case 'd': gameState.controls.joystickX = 1; break;
                    case ' ': // Jump
                        if(gameState.player.mesh) {
                            gameState.player.mesh.position.y += 2;
                            setTimeout(() => {
                                gameState.player.mesh.position.y -= 2;
                            }, 500);
                        }
                        break;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'w': case 's': gameState.controls.joystickY = 0; break;
                    case 'a': case 'd': gameState.controls.joystickX = 0; break;
                }
            });
        }
        
        function updateHealth() {
            const health = gameState.player.health;
            const healthBar = document.getElementById('healthBar');
            const healthValue = document.getElementById('healthValue');
            
            healthBar.style.width = `${health}%`;
            healthValue.textContent = `${health}%`;
            
            if(health <= 0) {
                alert("Game Over!");
                location.reload();
            }
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            if(!gameState.loaded || gameState.paused) return;
            
            requestAnimationFrame(animate);
            deltaTime = clock.getDelta();
            
            // Update Player Movement
            if(gameState.player.mesh) {
                const speed = 5 * deltaTime;
                gameState.player.mesh.position.x += gameState.controls.joystickX * speed;
                gameState.player.mesh.position.z += gameState.controls.joystickY * speed;
                
                // Update camera to follow player
                camera.position.x = gameState.player.mesh.position.x;
                camera.position.z = gameState.player.mesh.position.z + 5;
                camera.lookAt(gameState.player.mesh.position);
            }
            
            // Slowly regenerate health
            if(gameState.player.health < 100) {
                gameState.player.health += 0.1;
                updateHealth();
            }
            
            renderer.render(scene, camera);
        }
        
        // Start the game
        window.addEventListener('load', initGame);
        
        // Prevent default touch behaviors
        document.addEventListener('touchmove', (e) => {
            if(e.target.closest('#joystickArea') || e.target.closest('.action-button')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        console.log("Game script loaded!");
    </script>
</body>
</html>
