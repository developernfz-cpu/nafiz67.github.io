<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Open World Hope v3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;font-family:system-ui;background:#87ceeb}

/* UI */
#ui{
 position:fixed;top:10px;left:10px;
 background:#ffffffee;padding:12px;
 border-radius:12px;z-index:10;font-size:13px;
 min-width:150px
}
.bar{height:8px;background:#ddd;border-radius:4px;overflow:hidden;margin:4px 0}
.fill{height:100%;transition:width .15s}
#health{background:#e53935}
#stamina{background:#fbc02d}
#hunger{background:#fb8c00}

/* LOGIN */
#login{
 position:fixed;inset:0;background:#000c;
 display:flex;align-items:center;justify-content:center;z-index:99
}
#login .box{
 background:#fff;padding:22px;border-radius:14px;text-align:center
}

/* MOBILE */
#joy{
 position:fixed;left:20px;bottom:20px;
 width:120px;height:120px;border-radius:50%;
 background:#ffffff66;touch-action:none
}
#stick{
 width:46px;height:46px;border-radius:50%;
 background:#222;position:absolute;left:37px;top:37px
}
.btn{
 position:fixed;bottom:40px;
 width:70px;height:70px;border-radius:50%;
 border:none;font-weight:bold;background:#fff
}
#runBtn{right:100px}
#emoBtn{right:20px}

/* FX */
#light,#fade,#hitFlash{
 position:fixed;inset:0;pointer-events:none
}
#fade{background:#000;opacity:0;transition:1s}
#hitFlash{background:#fff;opacity:0}
</style>
</head>
<body>

<div id="login">
 <div class="box">
  <h2>Open World Hope</h2>
  <input id="name" placeholder="Your Name"><br><br>
  <button onclick="start()">ENTER</button>
 </div>
</div>

<div id="ui">
 <b id="uname"></b><br>
 ðŸ’µ $<span id="money"></span><br>
 ðŸ•’ <span id="timeText"></span>
 <div class="bar"><div id="health" class="fill"></div></div>
 <div class="bar"><div id="stamina" class="fill"></div></div>
 <div class="bar"><div id="hunger" class="fill"></div></div>
</div>

<div id="joy"><div id="stick"></div></div>
<button class="btn" id="runBtn">RUN</button>
<button class="btn" id="emoBtn">EMO</button>

<canvas id="game"></canvas>
<div id="light"></div>
<div id="fade"></div>
<div id="hitFlash"></div>

<script>
/* ===== CORE ===== */
const canvas=game,ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();onresize=resize;

/* ===== WORLD ===== */
const world={w:5000,h:5000};

/* ===== PLAYER ===== */
const player={
 x:2500,y:2500,w:18,h:24,
 vx:0,vy:0,dir:"down",
 health:100,stamina:100,hunger:100,
 money:100,alive:true,
 attackCD:0,hitCD:0,
 emote:0,name:"Player"
};

/* ===== CAMERA ===== */
const cam={x:0,y:0,shake:0};

/* ===== NPC ===== */
const npcs=Array.from({length:25},(_,i)=>({
 x:Math.random()*world.w,
 y:Math.random()*world.h,
 vx:0,vy:0,
 health:50,
 state:"idle",
 hostile:Math.random()>.6,
 hit:0,
 name:"NPC_"+i
}));

/* ===== INPUT ===== */
const keys={};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;
runBtn.ontouchstart=()=>keys.Shift=true;
runBtn.ontouchend=()=>keys.Shift=false;
emoBtn.onclick=()=>player.emote=40;

/* JOYSTICK */
let jx=0,jy=0;
joy.ontouchmove=e=>{
 const r=joy.getBoundingClientRect(),t=e.touches[0];
 jx=(t.clientX-(r.left+60))/40;
 jy=(t.clientY-(r.top+60))/40;
};
joy.ontouchend=()=>jx=jy=0;

/* ===== TIME ===== */
let time=6;
setInterval(()=>{
 time+=0.01;if(time>=24)time=0;
 timeText.textContent=Math.floor(time)+":00";
 light.style.background=(time<6||time>18)?"rgba(0,0,60,.45)":"transparent";
},100);

/* ===== START ===== */
function start(){
 player.name=name.value||"Player";
 uname.textContent=player.name;
 login.style.display="none";
}

/* ===== LOOP ===== */
let last=0;
function loop(ts){
 const dt=Math.min(32,ts-last);last=ts;
 update(dt/16);
 draw();
 requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== UPDATE ===== */
function update(dt){
 if(!player.alive)return;

 let ax=(keys.a||keys.ArrowLeft?-1:0)+(keys.d||keys.ArrowRight?1:0)+jx;
 let ay=(keys.w||keys.ArrowUp?-1:0)+(keys.s||keys.ArrowDown?1:0)+jy;

 if(ax||ay){
  if(Math.abs(ax)>Math.abs(ay))
   player.dir=ax>0?"right":"left";
  else player.dir=ay>0?"down":"up";
 }

 const run=keys.Shift&&player.stamina>0;
 const sp=run?4:2;
 if(run)player.stamina-=0.2;else player.stamina+=0.12;
 player.hunger-=0.0015;

 player.vx+=ax*0.4;player.vy+=ay*0.4;
 player.vx*=0.8;player.vy*=0.8;
 player.x+=player.vx*sp;player.y+=player.vy*sp;

 player.x=Math.max(0,Math.min(world.w,player.x));
 player.y=Math.max(0,Math.min(world.h,player.y));

 cam.x+=(player.x-cam.x-canvas.width/2)*0.08;
 cam.y+=(player.y-cam.y-canvas.height/2)*0.08;

 if(keys.f&&player.attackCD<=0){
  attack();
  player.attackCD=20;
 }
 if(player.attackCD>0)player.attackCD--;

 npcs.forEach(n=>{
  if(n.health<=0)return;
  const dx=player.x-n.x,dy=player.y-n.y;
  const dist=Math.hypot(dx,dy);
  if(n.hostile&&dist<180){
   n.vx+=dx/dist*0.4;
   n.vy+=dy/dist*0.4;
   if(dist<30&&player.hitCD<=0){
    damagePlayer(5,dx,dy);
    player.hitCD=30;
   }
  }
  n.vx*=0.85;n.vy*=0.85;
  n.x+=n.vx;n.y+=n.vy;
  if(n.hit>0)n.hit--;
 });

 if(player.hitCD>0)player.hitCD--;
}

/* ===== COMBAT ===== */
function attack(){
 npcs.forEach(n=>{
  if(n.health<=0)return;
  const dx=n.x-player.x,dy=n.y-player.y;
  const dist=Math.hypot(dx,dy);
  if(dist<40){
   n.health-=20;
   n.vx+=dx*0.1;n.vy+=dy*0.1;
   n.hit=10;
   cam.shake=10;
  }
 });
}

function damagePlayer(d,dx,dy){
 player.health-=d;
 player.vx-=dx*0.02;
 player.vy-=dy*0.02;
 hitFlash.style.opacity=.5;
 setTimeout(()=>hitFlash.style.opacity=0,100);
}

/* ===== DRAW ===== */
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.fillStyle="#6fcf97";
 ctx.fillRect(-cam.x,-cam.y,world.w,world.h);

 npcs.forEach(n=>{
  if(n.health<=0)return;
  ctx.fillStyle=n.hostile?"#c62828":"#1976d2";
  if(n.hit)ctx.fillStyle="#fff";
  ctx.fillRect(n.x-cam.x,n.y-cam.y,14,20);
  ctx.fillStyle="#000";
  ctx.fillText(n.name,n.x-cam.x-10,n.y-cam.y-6);
 });

 let bob=Math.sin(Date.now()/120)*2;
 let emo=player.emote?Math.sin(Date.now()/60)*6:0;
 ctx.fillStyle="#000";
 ctx.fillRect(player.x-cam.x,player.y-cam.y+bob-emo,player.w,player.h);
 ctx.fillText(player.name,player.x-cam.x-10,player.y-cam.y-8);

 health.style.width=player.health+"%";
 stamina.style.width=player.stamina+"%";
 hunger.style.width=player.hunger+"%";
 money.textContent=player.money;

 if(player.emote>0)player.emote--;
}
</script>
</body>
</html>
